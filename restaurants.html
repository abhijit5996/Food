<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurants - NutriOrder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Page transition animations */
        body {
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
            font-family: 'Poppins', sans-serif;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Link transitions */
        a, button {
            transition: all 0.3s ease;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a202c;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        /* Animation for hover effects */
        .hover\:scale-105:hover {
            transform: scale(1.05);
        }

        /* Custom glow effect */
        .glow {
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }

        /* Responsive tweaks */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
        }

        /* Match score indicator */
        .match-score {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            z-index: 10;
        }

        .match-score.high {
            background: rgba(74, 222, 128, 0.9);
        }

        .match-score.medium {
            background: rgba(250, 204, 21, 0.9);
        }

        .match-score.low {
            background: rgba(248, 113, 113, 0.9);
        }

        /* Badge styles */
        .diet-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
            margin-bottom: 4px;
            display: inline-block;
        }

        .vegetarian {
            background-color: #4ade80;
            color: #052e16;
        }

        .vegan {
            background-color: #86efac;
            color: #052e16;
        }

        .gluten-free {
            background-color: #a5b4fc;
            color: #1e1b4b;
        }

        .high-protein {
            background-color: #fca5a5;
            color: #450a0a;
        }

        .low-carb {
            background-color: #bae6fd;
            color: #083344;
        }

        .keto {
            background-color: #c7d2fe;
            color: #312e81;
        }

        .balanced {
            background-color: #ddd6fe;
            color: #4c1d95;
        }

        .diabetes-friendly {
            background-color: #bbf7d0;
            color: #14532d;
        }

        .heart-healthy {
            background-color: #bfdbfe;
            color: #1e3a8a;
        }

        .weight-loss {
            background-color: #fecaca;
            color: #7f1d1d;
        }

        .muscle-gain {
            background-color: #fed7aa;
            color: #7c2d12;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8b5cf6',
                        secondary: '#7c3aed',
                        dark: '#1f2937',
                        light: '#f3f4f6'
                    },
                    animation: {
                        'click': 'click 300ms ease-out',
                    },
                    keyframes: {
                        click: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(0.95)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-100">
    <!-- Navigation -->
    <nav class="bg-gray-800 py-4 px-6 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-utensils text-purple-500 text-2xl"></i>
                <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600">NutriOrder</span>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="homepage.html" class="hover:text-purple-400 transition">Home</a>
                <a href="recommended.html" class="hover:text-purple-400 transition">Recommended</a>
                <a href="restaurants.html" class="text-purple-400 font-semibold transition">Restaurants</a>
                <a href="index.html#contact" class="hover:text-purple-400 transition">Contact</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="login.html" class="flex items-center space-x-2 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-full transition">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login</span>
                </a>
                <button onclick="toggleCart()" class="flex items-center space-x-2 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-full transition">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="bg-white text-purple-600 rounded-full w-6 h-6 flex items-center justify-center">0</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-gray-800 to-gray-900 py-20 px-6">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-6">Our Partner <span class="text-purple-400">Restaurants</span></h1>
            <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto">Discover the best places to eat in your area with healthy options tailored to your needs.</p>
        </div>
        <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-gray-900 to-transparent"></div>
    </section>

    <!-- User Preferences Info -->
    <section id="user-prefs" class="bg-gray-800 py-6 px-6 shadow-lg hidden">
        <div class="container mx-auto">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-semibold text-white">Showing recommendations based on your profile</h3>
                    <div id="preferences-summary" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <a href="preferences.html" class="text-purple-400 hover:text-purple-300 text-sm flex items-center">
                    <i class="fas fa-edit mr-1"></i> Update preferences
                </a>
            </div>
            <div id="health-tips" class="mt-4 p-4 bg-gray-700 rounded-lg hidden">
                <h4 class="font-semibold text-purple-300 mb-2"><i class="fas fa-lightbulb mr-2"></i>Health Tips</h4>
                <div id="tips-content" class="text-sm text-gray-300"></div>
            </div>
        </div>
    </section>

    <!-- Restaurants Section -->
    <section class="text-gray-300 body-font py-12 bg-gray-900">
        <div class="container px-5 mx-auto">
            <!-- Search and Filters -->
            <div class="mb-8 bg-gray-800 p-6 rounded-lg shadow">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div class="relative flex-grow">
                        <input type="text" id="restaurant-search" placeholder="Search restaurants..." class="w-full bg-gray-700 rounded border border-gray-600 focus:border-purple-500 focus:bg-gray-600 focus:ring-2 focus:ring-purple-900 text-base outline-none text-white py-2 px-4 pl-10 leading-8 transition-colors duration-200 ease-in-out">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <select id="cuisine-filter" class="bg-gray-700 rounded border border-gray-600 focus:border-purple-500 focus:bg-gray-600 focus:ring-2 focus:ring-purple-900 text-base outline-none text-white py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
                            <option value="">All Cuisines</option>
                            <option value="north indian">North Indian</option>
                            <option value="south indian">South Indian</option>
                            <option value="chinese">Chinese</option>
                            <option value="mughlai">Mughlai</option>
                            <option value="street food">Street Food</option>
                            <option value="biryani">Biryani</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="desserts">Desserts</option>
                            <option value="mediterranean">Mediterranean</option>
                            <option value="japanese">Japanese</option>
                            <option value="thai">Thai</option>
                        </select>
                        <select id="diet-filter" class="bg-gray-700 rounded border border-gray-600 focus:border-purple-500 focus:bg-gray-600 focus:ring-2 focus:ring-purple-900 text-base outline-none text-white py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
                            <option value="">All Diets</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="gluten-free">Gluten-Free</option>
                            <option value="jain">Jain</option>
                            <option value="keto">Keto</option>
                            <option value="low-carb">Low-Carb</option>
                        </select>
                        <button id="reset-filters" class="text-gray-300 hover:text-purple-400 border border-gray-600 py-2 px-4 rounded-lg transition">
                            Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Recommended Restaurants -->
            <div class="mb-8">
                <h2 class="text-xl font-bold title-font mb-6 text-white flex items-center">
                    <i class="fas fa-heart text-purple-500 mr-2"></i> Recommended For You
                </h2>
                <div id="no-recommendations" class="bg-gray-800 p-8 rounded-lg text-center hidden">
                    <i class="fas fa-utensils text-4xl text-purple-500 mb-4"></i>
                    <h3 class="text-xl font-semibold text-white mb-2">No perfect matches found</h3>
                    <p class="text-gray-400 mb-4">We couldn't find restaurants that match all your preferences. Try adjusting your filters or preferences.</p>
                    <a href="preferences.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white py-2 px-6 rounded-lg transition">
                        Update Preferences
                    </a>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="recommended-restaurants">
                    <!-- Recommended restaurants will be loaded here -->
                </div>
            </div>
            
            <!-- All Restaurants -->
            <div>
                <h2 class="text-xl font-bold title-font mb-6 text-white">All Restaurants</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="all-restaurants">
                    <!-- All restaurants will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-80 bg-gray-800 shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto">
        <div class="p-4 border-b border-gray-700 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-white">Your Order</h3>
            <button onclick="toggleCart()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="cart-items" class="p-4">
            <!-- Cart items will be added here dynamically -->
            <p class="text-gray-400 text-center py-8">Your cart is empty</p>
        </div>
        <div class="p-4 border-t border-gray-700">
            <div class="flex justify-between mb-2 text-white">
                <span>Subtotal:</span>
                <span id="cart-subtotal">₹0.00</span>
            </div>
            <div class="flex justify-between mb-4 text-white">
                <span>Delivery:</span>
                <span>₹30.00</span>
            </div>
            <div class="flex justify-between font-bold text-lg text-white">
                <span>Total:</span>
                <span id="cart-total">₹30.00</span>
            </div>
            <a href="checkout.html" class="w-full bg-purple-600 text-white py-2 rounded-lg mt-4 hover:bg-purple-700 transition flex items-center justify-center">
                Checkout
            </a>
        </div>
    </div>
    <div id="cart-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" onclick="toggleCart()"></div>

    <!-- Menu Modal -->
    <div id="menu-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-900 opacity-75" onclick="hideRecipe()"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <div class="flex justify-between items-center">
                                <h3 id="menu-restaurant-name" class="text-lg leading-6 font-medium text-white"></h3>
                                <button onclick="hideRecipe()" class="text-gray-400 hover:text-gray-300">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <p id="menu-restaurant-cuisine" class="text-sm text-gray-400 mt-1"></p>
                            
                            <div id="menu-sections" class="mt-4 space-y-6">
                                <!-- Menu sections will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="hideRecipe()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-purple-600 text-base font-medium text-white hover:bg-purple-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm transition">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 py-12 px-6 border-t border-gray-800">
        <div class="container mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-utensils text-purple-500 mr-2"></i> NutriOrder
                    </h3>
                    <p class="text-gray-400">Where food meets health intelligence.</p>
                    <div class="flex space-x-4 mt-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Explore</h4>
                    <ul class="space-y-2">
                        <li><a href="homepage.html" class="text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="recommended.html" class="text-gray-400 hover:text-white">Recommended</a></li>
                        <li><a href="restaurants.html" class="text-gray-400 hover:text-white">Restaurants</a></li>
                        <li><a href="index.html#contact" class="text-gray-400 hover:text-white">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Company</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">About Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Careers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Blog</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Press</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Get Help</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
                        <li><a href="index.html#contact" class="text-gray-400 hover:text-white">Contact</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500">
                <p>© 2023 NutriOrder. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBx0Kt9o04ye0XrtA8ecp84wD8Q9OCDjlA",
            authDomain: "foodorder-4380c.firebaseapp.com",
            projectId: "foodorder-4380c",
            storageBucket: "foodorder-4380c.appspot.com",
            messagingSenderId: "735023580381",
            appId: "1:735023580381:web:c6740bef2fc9bdee1b4734"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
    
        // User preferences object
        let userPreferences = {};
    
        // Check auth state and load preferences
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in, get their preferences
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists() && userDoc.data().preferences) {
                    userPreferences = userDoc.data().preferences;
                    localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
                    showUserPreferences();
                    loadRestaurants();
                } else {
                    // Try to load from localStorage if not in Firestore
                    const localPrefs = localStorage.getItem('userPreferences');
                    if (localPrefs) {
                        userPreferences = JSON.parse(localPrefs);
                        showUserPreferences();
                        loadRestaurants();
                    }
                }
            } else {
                // User is not signed in, try to load from localStorage
                const localPrefs = localStorage.getItem('userPreferences');
                if (localPrefs) {
                    userPreferences = JSON.parse(localPrefs);
                    showUserPreferences();
                    loadRestaurants();
                }
            }
        });
    
        // Display user preferences at the top
        function showUserPreferences() {
            const prefsSection = document.getElementById('user-prefs');
            const prefsSummary = document.getElementById('preferences-summary');
            const healthTips = document.getElementById('health-tips');
            const tipsContent = document.getElementById('tips-content');
            
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                prefsSection.classList.add('hidden');
                return;
            }
            
            prefsSection.classList.remove('hidden');
            prefsSummary.innerHTML = '';
            
            // Show dietary preferences
            if (userPreferences.diet && userPreferences.diet.length > 0) {
                userPreferences.diet.forEach(diet => {
                    const badge = document.createElement('span');
                    badge.className = 'text-xs bg-purple-900 text-purple-200 px-2 py-1 rounded';
                    badge.textContent = diet.charAt(0).toUpperCase() + diet.slice(1);
                    prefsSummary.appendChild(badge);
                });
            }
            
            // Show fitness goals
            if (userPreferences.fitness_goal) {
                const badge = document.createElement('span');
                badge.className = 'text-xs bg-blue-900 text-blue-200 px-2 py-1 rounded';
                badge.textContent = 'Goal: ' + userPreferences.fitness_goal.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                prefsSummary.appendChild(badge);
            }
            
            // Show health conditions
            if (userPreferences.health_condition && userPreferences.health_condition.length > 0) {
                userPreferences.health_condition.forEach(condition => {
                    const badge = document.createElement('span');
                    badge.className = 'text-xs bg-green-900 text-green-200 px-2 py-1 rounded';
                    badge.textContent = condition.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    prefsSummary.appendChild(badge);
                });
            }
            
            // Generate health tips based on preferences
            const tips = generateHealthTips();
            if (tips.length > 0) {
                healthTips.classList.remove('hidden');
                tipsContent.innerHTML = tips.map(tip => `<p class="mb-2">• ${tip}</p>`).join('');
            } else {
                healthTips.classList.add('hidden');
            }
        }
    
        // Generate personalized health tips
        function generateHealthTips() {
            const tips = [];
            
            // Tips based on health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes')) {
                    tips.push("For diabetes management, focus on foods with low glycemic index like whole grains, lentils and fiber-rich vegetables.");
                }
                if (userPreferences.health_condition.includes('hypertension')) {
                    tips.push("To manage hypertension, choose foods low in sodium and rich in potassium like bananas, coconut water and leafy greens.");
                }
                if (userPreferences.health_condition.includes('heart-disease')) {
                    tips.push("For heart health, select foods low in saturated fats like grilled fish, sprouts and use healthy oils like mustard or olive oil.");
                }
                if (userPreferences.health_condition.includes('cholesterol')) {
                    tips.push("To lower cholesterol, opt for foods high in soluble fiber like oats, flaxseeds and legumes.");
                }
            }
            
            // Tips based on fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss') {
                    tips.push("For weight loss, focus on high-protein, high-fiber Indian foods like dal, sprouts and vegetable curries with minimal oil.");
                }
                if (userPreferences.fitness_goal === 'muscle-gain') {
                    tips.push("For muscle gain, ensure adequate protein intake (1.6-2.2g per kg of body weight daily) from paneer, eggs, chicken and lentils.");
                }
                if (userPreferences.fitness_goal === 'endurance') {
                    tips.push("For endurance training, include complex carbohydrates like whole wheat roti, brown rice and oats for sustained energy.");
                }
            }
            
            // General healthy eating tips
            if (tips.length === 0) {
                tips.push("Aim for a balanced Indian diet with plenty of vegetables, dal, roti/rice in moderation and healthy fats like ghee in small quantities.");
            }
            
            return tips;
        }
    
        // Shopping cart - load from localStorage or initialize empty
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Toggle cart visibility
        function toggleCart() {
            const cartSidebar = document.getElementById('cart-sidebar');
            const cartOverlay = document.getElementById('cart-overlay');
            
            cartSidebar.classList.toggle('translate-x-full');
            cartOverlay.classList.toggle('hidden');
            updateCart();
        }
    
        // Update cart UI
        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartSubtotal = document.getElementById('cart-subtotal');
            const cartTotal = document.getElementById('cart-total');
            
            // Update cart count
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            // Update cart items
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-400 text-center py-8">Your cart is empty</p>';
            } else {
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'flex justify-between items-center mb-4 pb-4 border-b border-gray-700';
                    cartItem.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.image}" alt="${item.name}" class="w-12 h-12 object-cover rounded">
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-white">${item.name}</h3>
                                <p class="text-xs text-gray-400">₹${item.price.toFixed(2)} x ${item.quantity}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-sm font-medium text-white">₹${(item.price * item.quantity).toFixed(2)}</span>
                            <button onclick="removeFromCart(${item.id})" class="ml-2 text-red-400 hover:text-red-300">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItem);
                });
            }
            
            // Update totals
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = 30; // 30 INR delivery fee
            const total = subtotal + deliveryFee;
            
            cartSubtotal.textContent = `₹${subtotal.toFixed(2)}`;
            cartTotal.textContent = `₹${total.toFixed(2)}`;
        }
    
        // Add item to cart
        function addToCart(item) {
            const existingItem = cart.find(i => i.id === item.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({...item, quantity: 1});
            }
            
            // Save to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            updateCart();
            showAddedToCartMessage(item.name);
        }
    
        // Show notification when item is added to cart
        function showAddedToCartMessage(itemName) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center';
            notification.innerHTML = `
                <i class="fas fa-check-circle mr-2"></i>
                ${itemName} added to cart!
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
    
        // Remove item from cart
        function removeFromCart(itemId) {
            const itemIndex = cart.findIndex(i => i.id === itemId);
            
            if (itemIndex !== -1) {
                if (cart[itemIndex].quantity > 1) {
                    cart[itemIndex].quantity -= 1;
                } else {
                    cart.splice(itemIndex, 1);
                }
                
                // Save to localStorage
                localStorage.setItem('cart', JSON.stringify(cart));
                
                updateCart();
            }
        }
    
        // Close menu modal
        function hideRecipe() {
            document.getElementById('menu-modal').classList.add('hidden');
        }
    
        // View restaurant menu
        function viewRestaurantMenu(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            document.getElementById('menu-restaurant-name').textContent = restaurant.name;
            document.getElementById('menu-restaurant-cuisine').textContent = restaurant.cuisine.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ');
            
            const menuSections = document.getElementById('menu-sections');
            menuSections.innerHTML = '';
            
            for (const [sectionName, items] of Object.entries(restaurant.menu)) {
                const section = document.createElement('div');
                section.className = 'menu-section';
                
                // Filter and sort items based on user preferences
                const filteredItems = items
                    .map(item => {
                        // Calculate match score for each item
                        const matchInfo = calculateFoodMatchScore(item, restaurant);
                        return {
                            ...item,
                            matchScore: matchInfo.score,
                            matchReasons: matchInfo.reasons
                        };
                    })
                    .filter(item => item.matchScore > 0) // Only show items with some match
                    .sort((a, b) => b.matchScore - a.matchScore); // Sort by best match first
                
                if (filteredItems.length === 0) continue;
                
                section.innerHTML = `
                    <h3 class="text-lg font-semibold text-white mb-4">${sectionName}</h3>
                    <div class="space-y-4">
                        ${filteredItems.map(item => `
                            <div class="flex items-start relative">
                                <div class="w-20 h-20 bg-gray-700 rounded-md overflow-hidden flex-shrink-0">
                                    <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                                    <div class="match-score ${getMatchScoreClass(item.matchScore)}">
                                        ${item.matchScore}
                                    </div>
                                </div>
                                <div class="ml-4 flex-grow">
                                    <h4 class="font-medium text-white">${item.name}</h4>
                                    <p class="text-sm text-gray-300 mt-1">${item.description}</p>
                                    <div class="mt-2 flex flex-wrap">
                                        ${item.matchReasons.map(reason => 
                                            `<span class="diet-badge ${reason.class}">${reason.text}</span>`
                                        ).join('')}
                                    </div>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="font-medium text-purple-400">₹${item.price.toFixed(2)}</span>
                                        <button onclick="addToCart(${JSON.stringify({
                                            id: item.id,
                                            name: item.name,
                                            price: item.price,
                                            image: item.image,
                                            restaurant: restaurant.name
                                        }).replace(/"/g, '&quot;')})" class="text-sm bg-purple-600 text-white py-1 px-3 rounded hover:bg-purple-700 transition">
                                            Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                menuSections.appendChild(section);
            }
            
            document.getElementById('menu-modal').classList.remove('hidden');
        }
    
        // Get CSS class for match score display
        function getMatchScoreClass(score) {
            if (score >= 8) return 'high';
            if (score >= 5) return 'medium';
            return 'low';
        }
    
        // Calculate how well a food item matches user preferences
        function calculateFoodMatchScore(foodItem, restaurant) {
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                return { score: 5, reasons: [] }; // Neutral score if no preferences
            }
            
            let score = 5; // Base score
            const reasons = [];
            
            // 1. Check dietary restrictions (strict filters - if these don't match, score should be 0)
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && !isVegetarian(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('vegan') && !isVegan(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('gluten-free') && !isGlutenFree(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('halal') && !isHalal(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('jain') && !isJain(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 2. Check allergies (strict filter)
            if (userPreferences.allergy) {
                if (hasAllergens(foodItem, userPreferences.allergy)) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 3. Add points for matching dietary preferences
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && isVegetarian(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Vegetarian', class: 'vegetarian' });
                }
                if (userPreferences.diet.includes('vegan') && isVegan(foodItem, restaurant)) {
                    score += 1.5;
                    reasons.push({ text: 'Vegan', class: 'vegan' });
                }
                if (userPreferences.diet.includes('gluten-free') && isGlutenFree(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Gluten-Free', class: 'gluten-free' });
                }
                if (userPreferences.diet.includes('jain') && isJain(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Jain', class: 'vegetarian' });
                }
            }
            
            // 4. Add points for matching meal preferences
            if (userPreferences.meal_pref) {
                if (userPreferences.meal_pref.includes('high-protein') && isHighProtein(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'High Protein', class: 'high-protein' });
                }
                if (userPreferences.meal_pref.includes('low-carb') && isLowCarb(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Low Carb', class: 'low-carb' });
                }
                if (userPreferences.meal_pref.includes('keto') && isKeto(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Keto', class: 'keto' });
                }
                if (userPreferences.meal_pref.includes('balanced') && isBalanced(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Balanced', class: 'balanced' });
                }
            }
            
            // 5. Adjust for health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes') && isDiabetesFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Diabetes-Friendly', class: 'diabetes-friendly' });
                }
                if (userPreferences.health_condition.includes('hypertension') && isLowSodium(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Low Sodium', class: 'heart-healthy' });
                }
                if (userPreferences.health_condition.includes('heart-disease') && isHeartHealthy(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Heart Healthy', class: 'heart-healthy' });
                }
                if (userPreferences.health_condition.includes('cholesterol') && isCholesterolFriendly(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Cholesterol-Friendly', class: 'heart-healthy' });
                }
            }
            
            // 6. Adjust for fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss' && isWeightLossFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Weight Loss', class: 'weight-loss' });
                }
                if (userPreferences.fitness_goal === 'muscle-gain' && isMuscleGainFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Muscle Gain', class: 'muscle-gain' });
                }
                if (userPreferences.fitness_goal === 'endurance' && isEnduranceFriendly(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Endurance', class: 'balanced' });
                }
            }
            
            // Cap score at 10
            score = Math.min(10, Math.round(score * 10) / 10);
            
            return { score, reasons };
        }
    
        // Food classification functions
        function isVegetarian(foodItem, restaurant) {
            const nonVegKeywords = ['chicken', 'meat', 'beef', 'pork', 'fish', 'seafood', 'shrimp', 'lamb', 'mutton', 'egg'];
            return !nonVegKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isVegan(foodItem, restaurant) {
            const nonVeganKeywords = ['cheese', 'milk', 'butter', 'cream', 'yogurt', 'honey', 'egg', 'paneer', 'ghee', 'dahi'];
            return isVegetarian(foodItem, restaurant) && 
                   !nonVeganKeywords.some(keyword => 
                       foodItem.name.toLowerCase().includes(keyword) || 
                       foodItem.description.toLowerCase().includes(keyword)
                   );
        }
    
        function isGlutenFree(foodItem, restaurant) {
            const glutenKeywords = ['wheat', 'bread', 'pasta', 'flour', 'barley', 'rye', 'soy sauce', 'maida', 'atta', 'besan'];
            return !glutenKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isHalal(foodItem, restaurant) {
            return restaurant.cuisine.includes('halal') || 
                   restaurant.name.toLowerCase().includes('halal');
        }
    
        function isJain(foodItem, restaurant) {
            const jainRestricted = ['onion', 'garlic', 'potato', 'carrot', 'radish', 'beetroot'];
            return isVegetarian(foodItem, restaurant) && 
                   !jainRestricted.some(keyword => 
                       foodItem.name.toLowerCase().includes(keyword) || 
                       foodItem.description.toLowerCase().includes(keyword)
                   );
        }
    
        function hasAllergens(foodItem, userAllergies) {
            const allergenMap = {
                'nuts': ['nut', 'almond', 'peanut', 'cashew', 'pistachio', 'walnut', 'kaju', 'badam'],
                'dairy': ['milk', 'cheese', 'butter', 'cream', 'yogurt', 'paneer', 'ghee', 'dahi'],
                'gluten': ['wheat', 'bread', 'pasta', 'flour', 'barley', 'rye', 'maida', 'atta'],
                'shellfish': ['shrimp', 'prawn', 'crab', 'lobster', 'shellfish', 'jhinga'],
                'soy': ['soy', 'tofu', 'soya', 'edamame'],
                'eggs': ['egg', 'mayo', 'mayonnaise', 'anda']
            };
            
            return userAllergies.some(allergy => {
                const keywords = allergenMap[allergy] || [];
                return keywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            });
        }
    
        function isHighProtein(foodItem) {
            const proteinKeywords = ['chicken', 'fish', 'tofu', 'beans', 'lentils', 'protein', 'steak', 'egg', 'paneer', 'dal', 'chana', 'rajma', 'sprouts'];
            return proteinKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isLowCarb(foodItem) {
            const carbKeywords = ['rice', 'pasta', 'bread', 'potato', 'noodle', 'sugar', 'roti', 'naan', 'paratha', 'poori'];
            return !carbKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isKeto(foodItem) {
            const ketoKeywords = ['keto', 'high-fat', 'avocado', 'cheese', 'butter', 'ghee', 'paneer'];
            const nonKetoKeywords = ['sugar', 'bread', 'pasta', 'rice', 'potato', 'roti', 'naan'];
            
            return (ketoKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   !nonKetoKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword))
            );
        }
    
        function isBalanced(foodItem) {
            const hasProtein = isHighProtein(foodItem);
            const hasVeggies = ['vegetable', 'salad', 'greens', 'spinach', 'kale', 'sabzi', 'bhaji'].some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
            const hasHealthyCarbs = ['quinoa', 'brown rice', 'whole grain', 'bajra', 'jowar'].some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
            
            return hasProtein && (hasVeggies || hasHealthyCarbs);
        }
    
        function isDiabetesFriendly(foodItem) {
            const badKeywords = ['sugar', 'syrup', 'juice', 'white rice', 'white bread', 'maida', 'fried', 'ghee'];
            const goodKeywords = ['high-fiber', 'whole grain', 'vegetable', 'protein', 'multigrain', 'bajra'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
        }
    
        function isLowSodium(foodItem) {
            const highSodiumKeywords = ['soy sauce', 'processed', 'canned', 'pickle', 'bacon', 'sausage', 'papad', 'chutney'];
            return !highSodiumKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isHeartHealthy(foodItem) {
            const badKeywords = ['fried', 'cream', 'butter', 'fatty', 'ghee', 'malai'];
            const goodKeywords = ['omega-3', 'salmon', 'avocado', 'olive oil', 'nuts', 'flaxseed'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isCholesterolFriendly(foodItem) {
            const badKeywords = ['fried', 'fatty', 'cream', 'butter', 'cheese', 'ghee'];
            const goodKeywords = ['fiber', 'oat', 'beans', 'lentil', 'vegetable', 'whole grain'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isWeightLossFriendly(foodItem) {
            const badKeywords = ['fried', 'cream', 'cheese', 'sugar', 'syrup', 'ghee', 'malai'];
            const goodKeywords = ['lean', 'grilled', 'steamed', 'vegetable', 'salad', 'sprouts'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isMuscleGainFriendly(foodItem) {
            return isHighProtein(foodItem);
        }
    
        function isEnduranceFriendly(foodItem) {
            const carbKeywords = ['whole grain', 'brown rice', 'quinoa', 'potato', 'oat', 'bajra', 'jowar'];
            return carbKeywords.some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        // Sample restaurant data with healthy Indian food options
        const restaurants = [
            {
                id: 1,
                name: "Green Bites - Healthy Indian Cuisine",
                cuisine: ["vegetarian", "healthy", "indian", "halal"],
                rating: 4.6,
                reviewCount: 320,
                description: "Specializing in fresh, organic Indian meals with plenty of vegetarian and vegan options.",
                image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                recommended: true,
                menu: {
                    "Healthy Breakfast": [
                        { id: 101, name: "Moong Dal Chilla", description: "Protein-rich pancakes made from moong dal with minimal oil. Served with mint chutney.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2021/03/Moong-Dal-Chilla-2-3.jpg" },
                        { id: 102, name: "Bajra Roti with Lauki Sabzi", description: "Nutritious pearl millet roti with bottle gourd vegetable curry.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Roti-2-3.jpg" },
                        { id: 103, name: "Sprouts Chaat", description: "Healthy sprouted moong beans with onions, tomatoes and spices.", price: 110, image: "https://www.whiskaffair.com/wp-content/uploads/2020/12/Sprouts-Chaat-2-3.jpg" },
                        { id: 104, name: "Oats Poha", description: "Light breakfast made with oats, peanuts and vegetables.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Poha-2-3.jpg" },
                        { id: 105, name: "Besan Chilla", description: "Gram flour pancakes stuffed with vegetables and spices.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Besan-Chilla-2-3.jpg" }
                    ],
                    "Soups & Salads": [
                        { id: 201, name: "Dal Shorba", description: "Light lentil soup with Indian spices, rich in protein and fiber.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-Shorba-2-3.jpg" },
                        { id: 202, name: "Quinoa Salad", description: "Organic quinoa with fresh vegetables and lemon dressing. High in fiber and protein.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Quinoa-Salad-2-3.jpg" },
                        { id: 203, name: "Sprouts Salad", description: "Healthy sprouted beans with cucumbers, tomatoes and lemon.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Salad-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 301, name: "Jowar Roti with Dal", description: "Sorghum flour roti with protein-rich lentil curry.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Roti-2-3.jpg" },
                        { id: 302, name: "Brown Rice with Rajma", description: "Whole grain brown rice with kidney bean curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Rajma-2-3.jpg" },
                        { id: 303, name: "Palak Paneer with Multigrain Roti", description: "Spinach curry with cottage cheese and multigrain flatbread.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Palak-Paneer-2-3.jpg" }
                    ],
                    "Healthy Desserts": [
                        { id: 401, name: "Dates Ladoo", description: "Sweet balls made from dates and nuts without added sugar.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dates-Ladoo-2-3.jpg" },
                        { id: 402, name: "Makhana Kheer", description: "Light pudding made from fox nuts and low-fat milk.", price: 100, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Makhana-Kheer-2-3.jpg" }
                    ]
                }
            },
            {
                id: 2,
                name: "Organic Indian Delights",
                cuisine: ["organic", "gluten-free", "vegan", "indian"],
                rating: 4.7,
                reviewCount: 280,
                description: "100% organic Indian ingredients with gluten-free and vegan options.",
                image: "https://images.unsplash.com/photo-1631515243349-e0cb75fb8d3a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1188&q=80",
                recommended: true,
                menu: {
                    "Organic Breakfast": [
                        { id: 501, name: "Ragi Dosa", description: "Dosa made with finger millet flour, rich in calcium.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" },
                        { id: 502, name: "Jowar Upma", description: "Healthy upma made with sorghum instead of semolina.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Upma-2-3.jpg" }
                    ],
                    "Organic Bowls": [
                        { id: 601, name: "Bajra Khichdi", description: "Pearl millet and moong dal porridge with vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Khichdi-2-3.jpg" },
                        { id: 602, name: "Quinoa Pulao", description: "Protein-rich quinoa cooked with Indian spices and vegetables.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Quinoa-Pulao-2-3.jpg" }
                    ],
                    "Organic Main Course": [
                        { id: 701, name: "Kuttu Roti with Lauki Sabzi", description: "Buckwheat flatbread with bottle gourd curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kuttu-Roti-2-3.jpg" },
                        { id: 702, name: "Samak Rice with Kadhi", description: "Barnyard millet with yogurt-based curry.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Samak-Rice-2-3.jpg" }
                    ]
                }
            },
            {
                id: 3,
                name: "Fit & Fresh - Indian Protein Kitchen",
                cuisine: ["healthy", "protein", "balanced", "indian"],
                rating: 4.5,
                reviewCount: 210,
                description: "Nutritionist-designed Indian meals for fitness enthusiasts.",
                image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1071&q=80",
                menu: {
                    "Protein Breakfast": [
                        { id: 801, name: "Paneer Bhurji with Multigrain Roti", description: "Scrambled cottage cheese with whole grain flatbread.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Bhurji-2-3.jpg" },
                        { id: 802, name: "Egg Bhurji with Jowar Roti", description: "Scrambled eggs with sorghum flatbread.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Egg-Bhurji-2-3.jpg" }
                    ],
                    "Protein Meals": [
                        { id: 901, name: "Grilled Chicken with Quinoa", description: "Lean chicken with protein-rich quinoa and vegetables.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Chicken-2-3.jpg" },
                        { id: 902, name: "Soya Chunks Curry with Brown Rice", description: "High-protein soy chunks in gravy with whole grain rice.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Soya-Chunks-Curry-2-3.jpg" }
                    ],
                    "Protein Shakes": [
                        { id: 1001, name: "Muscle Builder Shake", description: "Whey protein with banana, peanut butter and almond milk.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Protein-Shake-2-3.jpg" },
                        { id: 1002, name: "Vegan Protein Shake", description: "Plant-based protein with almond milk and berries.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Protein-Shake-2-3.jpg" }
                    ]
                }
            },
            {
                id: 4,
                name: "Vegan Indian Kitchen",
                cuisine: ["vegan", "plant-based", "organic", "indian"],
                rating: 4.6,
                reviewCount: 190,
                description: "100% plant-based Indian meals made with organic ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Vegan Breakfast": [
                        { id: 1101, name: "Sabudana Khichdi", description: "Tapioca pearls cooked with peanuts and spices.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sabudana-Khichdi-2-3.jpg" },
                        { id: 1102, name: "Ragi Dosa with Coconut Chutney", description: "Finger millet crepes with coconut dip.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" }
                    ],
                    "Plant-Based Mains": [
                        { id: 1201, name: "Vegan Thali", description: "Complete meal with dal, sabzi, roti, rice and salad.", price: 250, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Thali-2-3.jpg" },
                        { id: 1202, name: "Lentil Curry with Brown Rice", description: "Organic lentils with whole grain rice.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Lentil-Curry-2-3.jpg" }
                    ],
                    "Healthy Sides": [
                        { id: 1301, name: "Sweet Potato Fries", description: "Baked sweet potato fries with herbs.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sweet-Potato-Fries-2-3.jpg" },
                        { id: 1302, name: "Kale Chips", description: "Crispy baked kale with sea salt.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kale-Chips-2-3.jpg" }
                    ]
                }
            },
            {
                id: 5,
                name: "South Indian Healthy Kitchen",
                cuisine: ["south indian", "vegetarian", "healthy"],
                rating: 4.4,
                reviewCount: 175,
                description: "Authentic South Indian cuisine with healthy options.",
                image: "https://images.unsplash.com/photo-1631515243349-e0cb75fb8d3a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1188&q=80",
                recommended: true,
                menu: {
                    "Healthy Dosas": [
                        { id: 1401, name: "Ragi Dosa", description: "Dosa made with ragi flour, rich in calcium and fiber.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" },
                        { id: 1402, name: "Multigrain Dosa", description: "Dosa made with a blend of healthy grains.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Multigrain-Dosa-2-3.jpg" }
                    ],
                    "Healthy Idlis": [
                        { id: 1501, name: "Oats Idli", description: "Steamed cakes made with oats and lentils.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Idli-2-3.jpg" },
                        { id: 1502, name: "Ragi Idli", description: "Nutritious idlis made with finger millet.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Idli-2-3.jpg" }
                    ],
                    "Healthy Sides": [
                        { id: 1601, name: "Sambar", description: "Lentil-based vegetable stew with minimal oil.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sambar-2-3.jpg" },
                        { id: 1602, name: "Coconut Chutney", description: "Fresh coconut chutney with minimal oil.", price: 50, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Coconut-Chutney-2-3.jpg" }
                    ]
                }
            },
            {
                id: 6,
                name: "North Indian Healthy Bites",
                cuisine: ["north indian", "vegetarian", "healthy"],
                rating: 4.3,
                reviewCount: 195,
                description: "Traditional North Indian cuisine with a healthy twist.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Starters": [
                        { id: 1701, name: "Baked Samosa", description: "Whole wheat samosas with healthy fillings. Lower fat than traditional.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Samosa-2-3.jpg" },
                        { id: 1702, name: "Sprouts Chaat", description: "Healthy sprouts with Indian spices. High in protein and fiber.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Chaat-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 1801, name: "Dal Tadka", description: "Protein-rich lentils with minimal oil. Comfort food made healthy.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-Tadka-2-3.jpg" },
                        { id: 1802, name: "Paneer Tikka", description: "Grilled cottage cheese with veggies. High protein vegetarian option.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Tikka-2-3.jpg" }
                    ],
                    "Healthy Breads": [
                        { id: 1901, name: "Bajra Roti", description: "Pearl millet flatbread rich in fiber.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Roti-2-3.jpg" },
                        { id: 1902, name: "Jowar Roti", description: "Sorghum flatbread packed with nutrients.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Roti-2-3.jpg" }
                    ]
                }
            },
            {
                id: 7,
                name: "Keto Indian Kitchen",
                cuisine: ["keto", "low-carb", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 160,
                description: "Delicious keto-friendly Indian meals that keep you in ketosis.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Keto Breakfast": [
                        { id: 2001, name: "Keto Poha", description: "Low-carb poha made with cauliflower and nuts.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Poha-2-3.jpg" },
                        { id: 2002, name: "Keto Dosa", description: "Dosa made with almond flour and coconut flour.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Dosa-2-3.jpg" }
                    ],
                    "Keto Specials": [
                        { id: 2101, name: "Keto Butter Chicken", description: "Chicken in creamy tomato gravy without sugar.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Butter-Chicken-2-3.jpg" },
                        { id: 2102, name: "Cauliflower Rice Biryani", description: "Biryani made with cauliflower rice instead of regular rice.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Cauliflower-Rice-Biryani-2-3.jpg" }
                    ]
                }
            },
            {
                id: 8,
                name: "Diabetic Friendly Kitchen",
                cuisine: ["diabetes-friendly", "low-sugar", "healthy", "indian"],
                rating: 4.4,
                reviewCount: 140,
                description: "Indian meals specially designed for diabetics with low glycemic index.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Diabetic Breakfast": [
                        { id: 2201, name: "Besan Chilla", description: "Gram flour pancakes with vegetables, no sugar added.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Besan-Chilla-2-3.jpg" },
                        { id: 2202, name: "Moong Dal Cheela", description: "Protein-rich pancakes made from split green gram.", price: 160, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Moong-Dal-Cheela-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 2301, name: "Multigrain Roti with Lauki Sabzi", description: "Fiber-rich roti with bottle gourd curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Multigrain-Roti-2-3.jpg" },
                        { id: 2302, name: "Brown Rice with Dal", description: "Whole grain rice with lentil curry.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Brown-Rice-2-3.jpg" }
                    ]
                }
            },
            {
                id: 9,
                name: "Heart Healthy Indian Meals",
                cuisine: ["heart-healthy", "low-fat", "healthy", "indian"],
                rating: 4.3,
                reviewCount: 125,
                description: "Indian meals low in saturated fats and cholesterol for heart health.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Heart Healthy Breakfast": [
                        { id: 2401, name: "Oats Upma", description: "Healthy upma made with oats and vegetables.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Upma-2-3.jpg" },
                        { id: 2402, name: "Poha with Peanuts", description: "Flattened rice with peanuts and minimal oil.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Poha-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 2501, name: "Grilled Fish with Steamed Vegetables", description: "Omega-3 rich fish with fiber-rich vegetables.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Fish-2-3.jpg" },
                        { id: 2502, name: "Dal with Brown Rice", description: "Protein-rich lentils with whole grain rice.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-2-3.jpg" }
                    ]
                }
            },
            {
                id: 10,
                name: "Weight Loss Indian Meals",
                cuisine: ["weight-loss", "low-calorie", "healthy", "indian"],
                rating: 4.4,
                reviewCount: 180,
                description: "Delicious Indian meals under 500 calories for weight management.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Low-Calorie Breakfast": [
                        { id: 2601, name: "Vegetable Daliya", description: "Broken wheat porridge with vegetables.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegetable-Daliya-2-3.jpg" },
                        { id: 2602, name: "Ragi Porridge", description: "Finger millet porridge with nuts.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Porridge-2-3.jpg" }
                    ],
                    "Low-Calorie Meals": [
                        { id: 2701, name: "Vegetable Khichdi", description: "Light rice and lentil dish with vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegetable-Khichdi-2-3.jpg" },
                        { id: 2702, name: "Grilled Chicken with Salad", description: "Lean protein with fresh vegetables.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Chicken-Salad-2-3.jpg" }
                    ]
                }
            },
            {
                id: 11,
                name: "Muscle Gain Indian Kitchen",
                cuisine: ["high-protein", "healthy", "balanced", "indian"],
                rating: 4.6,
                reviewCount: 210,
                description: "High-protein Indian meals for muscle building and recovery.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Protein Plates": [
                        { id: 2801, name: "Egg Curry with Brown Rice", description: "Protein-rich eggs in gravy with whole grain rice.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Egg-Curry-2-3.jpg" },
                        { id: 2802, name: "Paneer Bhurji with Multigrain Roti", description: "Scrambled cottage cheese with fiber-rich flatbread.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Bhurji-2-3.jpg" }
                    ],
                    "Protein Shakes": [
                        { id: 2901, name: "Mass Gainer Shake", description: "Whey protein with banana, oats and milk.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Protein-Shake-2-3.jpg" },
                        { id: 2902, name: "Vegan Mass Gainer", description: "Plant-based protein with almond milk and dates.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Protein-Shake-2-3.jpg" }
                    ]
                }
            },
            {
                id: 12,
                name: "Jain Healthy Kitchen",
                cuisine: ["jain", "vegetarian", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 170,
                description: "Traditional Jain cuisine with healthy options without onion and garlic.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Jain Breakfast": [
                        { id: 3001, name: "Jain Poha", description: "Flattened rice without onion and garlic.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Poha-2-3.jpg" },
                        { id: 3002, name: "Jain Dosa", description: "Lentil and rice crepes without onion and garlic.", price: 160, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Dosa-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 3101, name: "Jain Dal Fry with Rice", description: "Lentil curry without onion and garlic.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Dal-Fry-2-3.jpg" },
                        { id: 3102, name: "Jain Sabzi with Roti", description: "Vegetable curry without root vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Sabzi-2-3.jpg" }
                    ]
                }
            },
            {
                id: 13,
                name: "Ayurvedic Indian Kitchen",
                cuisine: ["ayurvedic", "healthy", "balanced", "indian"],
                rating: 4.4,
                reviewCount: 150,
                description: "Traditional Indian meals prepared according to Ayurvedic principles.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Ayurvedic Breakfast": [
                        { id: 3201, name: "Kitchari", description: "Balancing meal of rice and mung beans with spices.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kitchari-2-3.jpg" },
                        { id: 3202, name: "Herbal Tea with Millets", description: "Detoxifying tea with nutritious millets.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Herbal-Tea-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 3301, name: "Tridoshic Thali", description: "Balanced meal for all body types according to Ayurveda.", price: 250, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Tridoshic-Thali-2-3.jpg" },
                        { id: 3302, name: "Ayurvedic Kadha", description: "Immunity-boosting herbal drink.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ayurvedic-Kadha-2-3.jpg" }
                    ]
                }
            },
            {
                id: 14,
                name: "Healthy Indian Street Food",
                cuisine: ["street food", "healthy", "indian"],
                rating: 4.3,
                reviewCount: 230,
                description: "Your favorite Indian street food made healthy with less oil and fresh ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Street Snacks": [
                        { id: 3401, name: "Baked Vada Pav", description: "Mumbai's favorite snack made healthy by baking instead of frying.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Vada-Pav-2-3.jpg" },
                        { id: 3402, name: "Grilled Paneer Tikka", description: "Cottage cheese marinated and grilled instead of fried.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Paneer-Tikka-2-3.jpg" }
                    ],
                    "Healthy Chats": [
                        { id: 3501, name: "Baked Samosa Chaat", description: "Baked samosas topped with healthy chutneys and yogurt.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Samosa-Chaat-2-3.jpg" },
                        { id: 3502, name: "Sprouts Bhel", description: "Healthy bhel made with sprouts instead of puffed rice.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Bhel-2-3.jpg" }
                    ]
                }
            },
            {
                id: 15,
                name: "Healthy Indian Desserts",
                cuisine: ["desserts", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 180,
                description: "Traditional Indian desserts made healthy with less sugar and healthy ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Sweets": [
                        { id: 3601, name: "Dates and Nuts Ladoo", description: "Sweet balls made from dates and nuts without added sugar.", price: 100, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dates-Ladoo-2-3.jpg" },
                        { id: 3602, name: "Sugar-free Gajar Halwa", description: "Carrot pudding sweetened with dates.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sugar-free-Gajar-Halwa-2-3.jpg" }
                    ],
                    "Healthy Drinks": [
                        { id: 3701, name: "Sugar-free Thandai", description: "Traditional drink made with nuts and spices, no sugar added.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sugar-free-Thandai-2-3.jpg" },
                        { id: 3702, name: "Low-fat Lassi", description: "Yogurt drink made with low-fat yogurt.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Low-fat-Lassi-2-3.jpg" }
                    ]
                }
            }
        ];
    
        // Load restaurants with personalized recommendations
        function loadRestaurants() {
            const recommendedContainer = document.getElementById('recommended-restaurants');
            const allContainer = document.getElementById('all-restaurants');
            const noRecsMessage = document.getElementById('no-recommendations');
            
            recommendedContainer.innerHTML = '';
            allContainer.innerHTML = '';
            
            // Filter and sort restaurants based on user preferences
            let recommendedRestaurants = [];
            let otherRestaurants = [];
            
            restaurants.forEach(restaurant => {
                // Calculate match score for each restaurant
                const matchInfo = calculateRestaurantMatchScore(restaurant);
                
                if (matchInfo.score >= 7) { // Threshold for "recommended"
                    recommendedRestaurants.push({
                        ...restaurant,
                        matchScore: matchInfo.score,
                        matchReasons: matchInfo.reasons
                    });
                } else {
                    otherRestaurants.push(restaurant);
                }
            });
            
            // Sort recommended restaurants by match score
            recommendedRestaurants.sort((a, b) => b.matchScore - a.matchScore);
            
            // Display recommended restaurants
            if (recommendedRestaurants.length > 0) {
                noRecsMessage.classList.add('hidden');
                recommendedRestaurants.forEach(restaurant => {
                    const restaurantCard = createRestaurantCard(restaurant, true);
                    recommendedContainer.appendChild(restaurantCard);
                });
            } else {
                noRecsMessage.classList.remove('hidden');
            }
            
            // Display all other restaurants
            otherRestaurants.forEach(restaurant => {
                const restaurantCard = createRestaurantCard(restaurant, false);
                allContainer.appendChild(restaurantCard);
            });
        }
    
        // Calculate how well a restaurant matches user preferences
        function calculateRestaurantMatchScore(restaurant) {
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                return { score: 0, reasons: [] }; // No score if no preferences
            }
            
            let score = 0;
            const reasons = [];
            
            // 1. Check dietary restrictions (strict filters)
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && !restaurant.cuisine.includes('vegetarian')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('vegan') && !restaurant.cuisine.includes('vegan')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('gluten-free') && !restaurant.cuisine.includes('gluten-free')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('halal') && !restaurant.cuisine.includes('halal')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('jain') && !restaurant.cuisine.includes('jain')) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 2. Add points for matching dietary preferences
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && restaurant.cuisine.includes('vegetarian')) {
                    score += 2;
                    reasons.push('Vegetarian options');
                }
                if (userPreferences.diet.includes('vegan') && restaurant.cuisine.includes('vegan')) {
                    score += 3;
                    reasons.push('Vegan options');
                }
                if (userPreferences.diet.includes('gluten-free') && restaurant.cuisine.includes('gluten-free')) {
                    score += 2;
                    reasons.push('Gluten-free options');
                }
                if (userPreferences.diet.includes('jain') && restaurant.cuisine.includes('jain')) {
                    score += 2;
                    reasons.push('Jain options');
                }
            }
            
            // 3. Add points for matching meal preferences
            if (userPreferences.meal_pref) {
                if (userPreferences.meal_pref.includes('high-protein') && restaurant.cuisine.includes('protein')) {
                    score += 2;
                    reasons.push('High-protein options');
                }
                if (userPreferences.meal_pref.includes('low-carb') && restaurant.cuisine.includes('low-carb')) {
                    score += 2;
                    reasons.push('Low-carb options');
                }
                if (userPreferences.meal_pref.includes('keto') && restaurant.cuisine.includes('keto')) {
                    score += 1;
                    reasons.push('Keto options');
                }
                if (userPreferences.meal_pref.includes('balanced') && restaurant.cuisine.includes('balanced')) {
                    score += 1;
                    reasons.push('Balanced meals');
                }
            }
            
            // 4. Adjust for health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes') && restaurant.cuisine.includes('diabetes-friendly')) {
                    score += 1.5;
                    reasons.push('Diabetes-friendly');
                }
                if (userPreferences.health_condition.includes('hypertension') && restaurant.cuisine.includes('low-sodium')) {
                    score += 1;
                    reasons.push('Low-sodium options');
                }
                if (userPreferences.health_condition.includes('heart-disease') && restaurant.cuisine.includes('heart-healthy')) {
                    score += 1;
                    reasons.push('Heart-healthy');
                }
            }
            
            // 5. Adjust for fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss' && restaurant.cuisine.includes('weight-loss')) {
                    score += 2;
                    reasons.push('Weight-loss friendly');
                }
                if (userPreferences.fitness_goal === 'muscle-gain' && restaurant.cuisine.includes('high-protein')) {
                    score += 2;
                    reasons.push('Muscle-gain friendly');
                }
            }
            
            // Cap score at 10
            score = Math.min(10, Math.round(score * 10) / 10);
            
            return { score, reasons };
        }
    
        // Create restaurant card HTML
        function createRestaurantCard(restaurant, isRecommended) {
            const restaurantCard = document.createElement('div');
            restaurantCard.className = 'bg-gray-800 rounded-lg shadow overflow-hidden hover:shadow-lg transition transform hover:-translate-y-1';
            
            let matchScoreHTML = '';
            let reasonsHTML = '';
            
            if (isRecommended && restaurant.matchScore) {
                matchScoreHTML = `
                    <div class="match-score ${getMatchScoreClass(restaurant.matchScore)}">
                        ${restaurant.matchScore}
                    </div>
                `;
                
                if (restaurant.matchReasons && restaurant.matchReasons.length > 0) {
                    reasonsHTML = `
                        <div class="mt-2 flex flex-wrap">
                            ${restaurant.matchReasons.map(reason => 
                                `<span class="text-xs bg-purple-900 text-purple-200 px-2 py-1 rounded mr-2 mb-2">${reason}</span>`
                            ).join('')}
                        </div>
                    `;
                }
            }
            
            restaurantCard.innerHTML = `
                <div class="relative">
                    <img class="w-full h-48 object-cover" src="${restaurant.image}" alt="${restaurant.name}">
                    ${matchScoreHTML}
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold text-white">${restaurant.name}</h3>
                    <div class="flex items-center mt-2">
                        <div class="flex text-yellow-400">
                            ${'<i class="fas fa-star"></i>'.repeat(Math.floor(restaurant.rating))}
                            ${restaurant.rating % 1 >= 0.5 ? '<i class="fas fa-star-half-alt"></i>' : ''}
                        </div>
                        <span class="ml-2 text-sm text-gray-400">${restaurant.rating} (${restaurant.reviewCount} reviews)</span>
                    </div>
                    <div class="mt-2 flex flex-wrap gap-2">
                        ${restaurant.cuisine.map(cuisine => 
                            `<span class="text-xs bg-blue-900 text-blue-200 px-2 py-1 rounded">${cuisine.charAt(0).toUpperCase() + cuisine.slice(1)}</span>`
                        ).join('')}
                    </div>
                    <p class="mt-2 text-sm text-gray-400">${restaurant.description}</p>
                    ${reasonsHTML}
                    <button onclick="viewRestaurantMenu(${restaurant.id})" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">
                        View Menu
                    </button>
                </div>
            `;
            
            return restaurantCard;
        }
    
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load preferences from localStorage if Firebase hasn't loaded them yet
            const localPrefs = localStorage.getItem('userPreferences');
            if (localPrefs && (!userPreferences || Object.keys(userPreferences).length === 0)) {
                userPreferences = JSON.parse(localPrefs);
                showUserPreferences();
                loadRestaurants();
            }
            
            updateCart(); // Initialize cart count on page load
            
            // Add smooth transition to all links
            document.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function(e) {
                    // Don't apply to:
                    // 1. External links
                    // 2. Anchor links (#)
                    // 3. Links to the current page
                    if (!this.href || 
                        this.href.startsWith('http') || 
                        this.href.includes('#') || 
                        this.href === window.location.href) {
                        return;
                    }
                    
                    e.preventDefault();
                    document.body.style.opacity = '0';
                    document.body.style.transition = 'opacity 0.3s ease';
                    
                    setTimeout(() => {
                        window.location.href = this.href;
                    }, 300);
                });
            });
            
            // Search functionality
            document.getElementById('restaurant-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filterRestaurants();
            });
            
            // Filter functionality
            document.getElementById('cuisine-filter').addEventListener('change', filterRestaurants);
            document.getElementById('diet-filter').addEventListener('change', filterRestaurants);
            
            // Reset filters
            document.getElementById('reset-filters').addEventListener('click', function() {
                document.getElementById('restaurant-search').value = '';
                document.getElementById('cuisine-filter').value = '';
                document.getElementById('diet-filter').value = '';
                filterRestaurants();
            });
        });
    
        // Filter restaurants based on search and filters
        function filterRestaurants() {
            const searchTerm = document.getElementById('restaurant-search').value.toLowerCase();
            const cuisineFilter = document.getElementById('cuisine-filter').value;
            const dietFilter = document.getElementById('diet-filter').value;
            
            const allCards = document.querySelectorAll('#recommended-restaurants > div, #all-restaurants > div');
            
            allCards.forEach(card => {
                const name = card.querySelector('h3').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                const cuisineBadges = Array.from(card.querySelectorAll('.flex-wrap span')).map(span => span.textContent.toLowerCase());
                
                const matchesSearch = searchTerm === '' || 
                    name.includes(searchTerm) || 
                    description.includes(searchTerm);
                
                const matchesCuisine = cuisineFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(cuisineFilter));
                
                const matchesDiet = dietFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(dietFilter));
                
                if (matchesSearch && matchesCuisine && matchesDiet) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>