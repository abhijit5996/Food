<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurants - NutriOrder | Traditional Indian Healthy Foods</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Page transition animations */
        body {
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
            font-family: 'Poppins', sans-serif;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Link transitions */
        a, button {
            transition: all 0.3s ease;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #e11d48;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #be123c;
        }

        /* Animation for hover effects */
        .hover\:scale-105:hover {
            transform: scale(1.05);
        }

        /* Custom glow effect */
        .glow {
            box-shadow: 0 0 15px rgba(225, 29, 72, 0.3);
        }

        /* Pulse animation for CTA */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(90deg, #e11d48, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        /* Responsive tweaks */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
        }

        /* Custom card hover effect */
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(225, 29, 72, 0.15);
        }

        /* Custom border animation */
        .border-animate {
            position: relative;
        }

        .border-animate::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            padding: 2px;
            background: linear-gradient(45deg, #e11d48, #f59e0b);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .border-animate:hover::before {
            opacity: 1;
        }

        /* Custom underline animation */
        .underline-animate {
            position: relative;
        }

        .underline-animate::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background: linear-gradient(90deg, #e11d48, #f59e0b);
            transition: width 0.3s ease;
        }

        .underline-animate:hover::after {
            width: 100%;
        }

        /* Custom blob background */
        @keyframes animate-blob {
            0% {
                transform: translate(0px, 0px) scale(1);
            }
            33% {
                transform: translate(30px, -50px) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) scale(0.9);
            }
            100% {
                transform: translate(0px, 0px) scale(1);
            }
        }

        .animate-blob {
            animation: animate-blob 7s infinite;
        }

        .animation-delay-2000 {
            animation-delay: 2s;
        }

        .animation-delay-4000 {
            animation-delay: 4s;
        }

        /* Indian pattern overlay */
        .indian-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e11d48' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.1;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Special heading font */
        .heading-font {
            font-family: 'Playfair Display', serif;
        }

        /* Custom button shine effect */
        .btn-shine:hover {
            position: relative;
            overflow: hidden;
        }

        .btn-shine:hover::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 40%;
            height: 200%;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(30deg);
            animation: shine 1.5s ease;
        }

        @keyframes shine {
            100% {
                left: 120%;
            }
        }

        /* Match score indicator */
        .match-score {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            z-index: 10;
        }

        .match-score.high {
            background: rgba(74, 222, 128, 0.9);
        }

        .match-score.medium {
            background: rgba(250, 204, 21, 0.9);
        }

        .match-score.low {
            background: rgba(248, 113, 113, 0.9);
        }

        /* Badge styles */
        .diet-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
            margin-bottom: 4px;
            display: inline-block;
        }

        .vegetarian {
            background-color: #4ade80;
            color: #052e16;
        }

        .vegan {
            background-color: #86efac;
            color: #052e16;
        }

        .gluten-free {
            background-color: #a5b4fc;
            color: #1e1b4b;
        }

        .high-protein {
            background-color: #fca5a5;
            color: #450a0a;
        }

        .low-carb {
            background-color: #bae6fd;
            color: #083344;
        }

        .keto {
            background-color: #c7d2fe;
            color: #312e81;
        }

        .balanced {
            background-color: #ddd6fe;
            color: #4c1d95;
        }

        .diabetes-friendly {
            background-color: #bbf7d0;
            color: #14532d;
        }

        .heart-healthy {
            background-color: #bfdbfe;
            color: #1e3a8a;
        }

        .weight-loss {
            background-color: #fecaca;
            color: #7f1d1d;
        }

        .muscle-gain {
            background-color: #fed7aa;
            color: #7c2d12;
        }

        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e11d48;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error message */
        .error-message {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin: 1rem 0;
            color: #b91c1c;
            border-radius: 0.375rem;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#e11d48',
                        secondary: '#be123c',
                        accent: '#f59e0b',
                        light: '#fff7ed',
                        dark: '#1f2937'
                    },
                    animation: {
                        'click': 'click 300ms ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        click: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(0.95)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-amber-50 text-gray-800 min-h-screen">
     <!-- Navigation -->
     <nav class="bg-white/90 backdrop-blur-md py-4 px-6 shadow-sm sticky top-0 z-50 border-b border-amber-200">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-utensils text-red-600 text-2xl"></i>
                <span class="text-xl font-bold gradient-text heading-font">NutriOrder</span>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="homepage.html" class="hover:text-red-600 transition underline-animate">Home</a>
                <a href="recommended.html" class="hover:text-red-600 transition underline-animate">Recommended</a>
                <a href="restaurants.html" class="hover:text-red-600 transition underline-animate">Restaurants</a>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="toggleCart()" class="flex items-center space-x-2 bg-gradient-to-r from-red-600 to-amber-600 hover:from-red-700 hover:to-amber-700 px-4 py-2 rounded-full transition shadow-lg relative group text-white btn-shine">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="bg-white text-red-600 rounded-full w-6 h-6 flex items-center justify-center font-bold">0</span>
                    <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity" id="cart-hover-count">0</span>
                </button>
                <div class="relative">
                    <button id="profile-button" class="flex items-center space-x-2 bg-amber-100 hover:bg-amber-200 px-4 py-2 rounded-full transition border-animate">
                        <i class="fas fa-user-circle text-red-600"></i>
                        <span id="profile-name" class="text-gray-700"></span>
                        <i class="fas fa-chevron-down text-xs text-gray-600"></i>
                    </button>
                    <div id="profile-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden border border-amber-200 backdrop-blur-sm">
                        <a href="dashboard.html" class="block px-4 py-2 text-sm hover:bg-amber-50 transition text-gray-700">Dashboard</a>
                        <a href="orders.html" class="block px-4 py-2 text-sm hover:bg-amber-50 transition text-gray-700">My Orders</a>
                        <a href="settings.html" class="block px-4 py-2 text-sm hover:bg-amber-50 transition text-gray-700">Settings</a>
                        <a href="#" onclick="logout()" class="block px-4 py-2 text-sm hover:bg-amber-50 transition text-gray-700">Sign out</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-amber-50 to-red-50 py-24 px-6 overflow-hidden">
        <div class="indian-pattern"></div>
        <div class="absolute inset-0 opacity-60">
            <div class="absolute top-0 left-0 w-64 h-64 bg-red-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-amber-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
            <div class="absolute bottom-0 left-1/2 w-64 h-64 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
        </div>
        <div class="container mx-auto text-center relative z-10">
            <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight heading-font">
                Our Partner <span class="gradient-text">Restaurants</span>
            </h1>
            <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto text-gray-600">
                Discover the best places to eat in your area with healthy options tailored to your needs.
            </p>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                <a href="#restaurants">
                    <button class="bg-gradient-to-r from-red-600 to-amber-600 hover:from-red-700 hover:to-amber-700 text-white px-8 py-4 rounded-full font-bold transition transform hover:scale-105 shadow-lg pulse btn-shine">
                        Explore Restaurants <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </a>
                <button class="bg-white hover:bg-amber-100 text-gray-800 px-8 py-4 rounded-full font-bold transition transform hover:scale-105 shadow-lg border border-amber-200">
                    How It Works <i class="fas fa-info-circle ml-2"></i>
                </button>
            </div>
        </div>
        <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-amber-50 to-transparent"></div>
        <div class="absolute top-1/2 right-10 transform -translate-y-1/2 floating hidden lg:block">
            <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80" alt="Restaurant interior" class="w-72 h-72 object-cover rounded-xl shadow-2xl border-4 border-white">
        </div>
    </section>

    <!-- User Preferences Info -->
    <section id="user-prefs" class="bg-white py-6 px-6 shadow-md rounded-lg mx-6 mb-12 hidden">
        <div class="container mx-auto">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">Showing recommendations based on your profile</h3>
                    <div id="preferences-summary" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <a href="preferences.html" class="text-red-600 hover:text-red-500 text-sm flex items-center">
                    <i class="fas fa-edit mr-1"></i> Update preferences
                </a>
            </div>
            <div id="health-tips" class="mt-4 p-4 bg-amber-50 rounded-lg hidden">
                <h4 class="font-semibold text-red-600 mb-2"><i class="fas fa-lightbulb mr-2"></i>Health Tips</h4>
                <div id="tips-content" class="text-sm text-gray-600"></div>
            </div>
        </div>
    </section>

    <!-- Error Message Container -->
    <div id="error-container" class="container mx-auto px-6 hidden">
        <div class="error-message">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="error-message-text"></span>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <div class="loader"></div>
            <p class="mt-4 text-gray-700">Loading restaurants...</p>
        </div>
    </div>

    <!-- Restaurants Section -->
    <section id="restaurants" class="py-20 px-6 bg-white">
        <div class="container mx-auto">
            <!-- Search and Filters -->
            <div class="mb-8 bg-amber-50 p-6 rounded-lg shadow border border-amber-200">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div class="relative flex-grow">
                        <input type="text" id="restaurant-search" placeholder="Search restaurants..." class="w-full bg-white rounded border border-amber-300 focus:border-red-500 focus:bg-white focus:ring-2 focus:ring-red-200 text-base outline-none text-gray-700 py-2 px-4 pl-10 leading-8 transition-colors duration-200 ease-in-out">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <select id="cuisine-filter" class="bg-white rounded border border-amber-300 focus:border-red-500 focus:bg-white focus:ring-2 focus:ring-red-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
                            <option value="">All Cuisines</option>
                            <option value="north indian">North Indian</option>
                            <option value="south indian">South Indian</option>
                            <option value="chinese">Chinese</option>
                            <option value="mughlai">Mughlai</option>
                            <option value="street food">Street Food</option>
                            <option value="biryani">Biryani</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="desserts">Desserts</option>
                            <option value="mediterranean">Mediterranean</option>
                            <option value="japanese">Japanese</option>
                            <option value="thai">Thai</option>
                        </select>
                        <select id="diet-filter" class="bg-white rounded border border-amber-300 focus:border-red-500 focus:bg-white focus:ring-2 focus:ring-red-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
                            <option value="">All Diets</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="gluten-free">Gluten-Free</option>
                            <option value="jain">Jain</option>
                            <option value="keto">Keto</option>
                            <option value="low-carb">Low-Carb</option>
                        </select>
                        <button id="reset-filters" class="text-gray-700 hover:text-red-600 border border-amber-300 py-2 px-4 rounded-lg transition bg-white">
                            Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Recommended Restaurants -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold title-font mb-6 text-gray-800 flex items-center heading-font">
                    <i class="fas fa-heart text-red-600 mr-2"></i> Recommended For You
                </h2>
                <div id="no-recommendations" class="bg-amber-50 p-8 rounded-lg text-center border border-amber-200 hidden">
                    <i class="fas fa-utensils text-4xl text-red-600 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">No perfect matches found</h3>
                    <p class="text-gray-600 mb-4">We couldn't find restaurants that match all your preferences. Try adjusting your filters or preferences.</p>
                    <a href="preferences.html" class="inline-block bg-gradient-to-r from-red-600 to-amber-600 hover:from-red-700 hover:to-amber-700 text-white py-2 px-6 rounded-lg transition btn-shine">
                        Update Preferences
                    </a>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="recommended-restaurants">
                    <!-- Recommended restaurants will be loaded here -->
                </div>
            </div>
            
            <!-- All Restaurants -->
            <div>
                <h2 class="text-2xl font-bold title-font mb-6 text-gray-800 heading-font">All Restaurants</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="all-restaurants">
                    <!-- All restaurants will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-96 bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto border-l border-amber-200">
        <div class="p-6 border-b border-amber-200 flex justify-between items-center bg-white">
            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                <i class="fas fa-shopping-cart text-red-600 mr-2"></i> Your Order
            </h3>
            <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700" aria-label="Close cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="cart-items" class="p-6">
            <!-- Cart items will be added here dynamically -->
            <div class="text-center py-12">
                <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500">Your cart is empty</p>
                <button onclick="toggleCart()" class="mt-4 text-red-600 hover:text-red-500 underline">
                    Browse our menu
                </button>
            </div>
        </div>
        <div class="p-6 border-t border-amber-200 bg-white">
            <div class="flex justify-between mb-3 text-gray-700">
                <span>Subtotal:</span>
                <span id="cart-subtotal">₹0.00</span>
            </div>
            <div class="flex justify-between mb-3 text-gray-700">
                <span>Delivery Fee:</span>
                <span>₹30.00</span>
            </div>
            <div class="flex justify-between mb-6 text-lg font-bold text-gray-800">
                <span>Total:</span>
                <span id="cart-total">₹30.00</span>
            </div>
            <a href="checkout.html" class="w-full bg-gradient-to-r from-red-600 to-amber-600 text-white py-3 rounded-lg hover:from-red-700 hover:to-amber-700 transition flex items-center justify-center shadow-lg btn-shine">
                <i class="fas fa-credit-card mr-2"></i> Proceed to Checkout
            </a>
        </div>
    </div>
    <div id="cart-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm" onclick="toggleCart()"></div>

    <!-- Menu Modal -->
    <div id="menu-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-900 opacity-75" onclick="hideMenuModal()"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <div class="flex justify-between items-center">
                                <h3 id="menu-restaurant-name" class="text-lg leading-6 font-medium text-gray-800"></h3>
                                <button onclick="hideMenuModal()" class="text-gray-400 hover:text-gray-500" aria-label="Close menu">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <p id="menu-restaurant-cuisine" class="text-sm text-gray-600 mt-1"></p>
                            
                            <div id="menu-sections" class="mt-4 space-y-6">
                                <!-- Menu sections will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-amber-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="hideMenuModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gradient-to-r from-red-600 to-amber-600 text-base font-medium text-white hover:from-red-700 hover:to-amber-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm transition btn-shine">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white py-16 px-6 border-t border-amber-200">
        <div class="container mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div>
                    <h3 class="text-xl font-bold mb-4 flex items-center heading-font">
                        <i class="fas fa-utensils text-red-500 mr-2"></i> NutriOrder
                    </h3>
                    <p class="text-gray-600 mb-4">Where traditional Indian food meets health intelligence.</p>
                    <div class="flex space-x-4 mt-4">
                        <a href="#" class="text-gray-600 hover:text-red-600"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-600 hover:text-red-600"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-600 hover:text-red-600"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4 text-gray-800">Explore</h4>
                    <ul class="space-y-3">
                        <li><a href="homepage.html" class="text-gray-600 hover:text-red-600 transition underline-animate">Home</a></li>
                        <li><a href="recommended.html" class="text-gray-600 hover:text-red-600 transition underline-animate">Recommended</a></li>
                        <li><a href="restaurants.html" class="text-gray-600 hover:text-red-600 transition underline-animate">Restaurants</a></li>
                        <li><a href="index.html#contact" class="text-gray-600 hover:text-red-600 transition underline-animate">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4 text-gray-800">Company</h4>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">About Us</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">Careers</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">Blog</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">Press</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4 text-gray-800">Get Help</h4>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">FAQ</a></li>
                        <li><a href="index.html#contact" class="text-gray-600 hover:text-red-600 transition underline-animate">Contact</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">Privacy</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-red-600 transition underline-animate">Terms</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-amber-200 mt-12 pt-8 text-center text-gray-500">
                <p>© 2023 NutriOrder. All rights reserved. | Designed with <i class="fas fa-heart text-red-500"></i> for your health</p>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
        // Firebase configuration - Replace with your actual config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
    
        // Initialize Firebase
        let app;
        let auth;
        let db;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (error) {
            console.error('Firebase initialization error:', error);
            showError('Failed to initialize the application. Please try again later.');
        }
    
        // User preferences object
        let userPreferences = {};
        let authStateListenerUnsubscribe = null;
    
        // Check auth state and load preferences
        function setupAuthListener() {
            if (!auth) return;
            
            authStateListenerUnsubscribe = onAuthStateChanged(auth, async (user) => {
                try {
                    if (user) {
                        // Update UI for logged in user
                        document.getElementById('login-btn').classList.add('hidden');
                        document.getElementById('profile-section').classList.remove('hidden');
                        document.getElementById('profile-name').textContent = user.displayName || user.email.split('@')[0];
                        
                        // Load profile picture if available
                        if (user.photoURL) {
                            const profileButton = document.getElementById('profile-button');
                            const iconElement = profileButton.querySelector('.fas.fa-user-circle');
                            if (iconElement) {
                                iconElement.remove();
                            }
                            
                            const profilePic = document.createElement('img');
                            profilePic.src = user.photoURL;
                            profilePic.alt = 'Profile';
                            profilePic.className = 'h-8 w-8 rounded-full object-cover mr-2';
                            profileButton.prepend(profilePic);
                        }
        
                        // Get user preferences from Firestore
                        if (db) {
                            const userDocRef = doc(db, 'users', user.uid);
                            const userDoc = await getDoc(userDocRef);
                            
                            if (userDoc.exists() && userDoc.data().preferences) {
                                userPreferences = userDoc.data().preferences;
                                localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
                                showUserPreferences();
                                loadRestaurants();
                            } else {
                                // Try to load from localStorage if not in Firestore
                                loadPreferencesFromLocalStorage();
                            }
                        } else {
                            loadPreferencesFromLocalStorage();
                        }
                    } else {
                        // Update UI for logged out user
                        document.getElementById('login-btn').classList.remove('hidden');
                        document.getElementById('profile-section').classList.add('hidden');
                        
                        // Try to load from localStorage
                        loadPreferencesFromLocalStorage();
                    }
                } catch (error) {
                    console.error('Auth state change error:', error);
                    showError('Failed to load user data. Please refresh the page.');
                }
            });
        }
        
        function loadPreferencesFromLocalStorage() {
            try {
                const localPrefs = localStorage.getItem('userPreferences');
                if (localPrefs) {
                    userPreferences = JSON.parse(localPrefs);
                    showUserPreferences();
                    loadRestaurants();
                }
            } catch (error) {
                console.error('Error loading preferences from localStorage:', error);
                localStorage.removeItem('userPreferences');
            }
        }
    
        // Logout function
        window.logout = async function() {
            try {
                if (auth) {
                    await signOut(auth);
                }
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                showError('Failed to sign out. Please try again.');
            }
        };
    
        // Display user preferences at the top
        function showUserPreferences() {
            const prefsSection = document.getElementById('user-prefs');
            const prefsSummary = document.getElementById('preferences-summary');
            const healthTips = document.getElementById('health-tips');
            const tipsContent = document.getElementById('tips-content');
            
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                prefsSection.classList.add('hidden');
                return;
            }
            
            prefsSection.classList.remove('hidden');
            prefsSummary.innerHTML = '';
            
            // Show dietary preferences
            if (userPreferences.diet && userPreferences.diet.length > 0) {
                userPreferences.diet.forEach(diet => {
                    const badge = document.createElement('span');
                    badge.className = 'text-xs bg-red-100 text-red-800 px-2 py-1 rounded';
                    badge.textContent = diet.charAt(0).toUpperCase() + diet.slice(1);
                    prefsSummary.appendChild(badge);
                });
            }
            
            // Show fitness goals
            if (userPreferences.fitness_goal) {
                const badge = document.createElement('span');
                badge.className = 'text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded';
                badge.textContent = 'Goal: ' + userPreferences.fitness_goal.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                prefsSummary.appendChild(badge);
            }
            
            // Show health conditions
            if (userPreferences.health_condition && userPreferences.health_condition.length > 0) {
                userPreferences.health_condition.forEach(condition => {
                    const badge = document.createElement('span');
                    badge.className = 'text-xs bg-green-100 text-green-800 px-2 py-1 rounded';
                    badge.textContent = condition.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    prefsSummary.appendChild(badge);
                });
            }
            
            // Generate health tips based on preferences
            const tips = generateHealthTips();
            if (tips.length > 0) {
                healthTips.classList.remove('hidden');
                tipsContent.innerHTML = tips.map(tip => `<p class="mb-2">• ${tip}</p>`).join('');
            } else {
                healthTips.classList.add('hidden');
            }
        }
    
        // Generate personalized health tips
        function generateHealthTips() {
            const tips = [];
            
            if (!userPreferences) return tips;
            
            // Tips based on health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes')) {
                    tips.push("For diabetes management, focus on foods with low glycemic index like whole grains, lentils and fiber-rich vegetables.");
                }
                if (userPreferences.health_condition.includes('hypertension')) {
                    tips.push("To manage hypertension, choose foods low in sodium and rich in potassium like bananas, coconut water and leafy greens.");
                }
                if (userPreferences.health_condition.includes('heart-disease')) {
                    tips.push("For heart health, select foods low in saturated fats like grilled fish, sprouts and use healthy oils like mustard or olive oil.");
                }
                if (userPreferences.health_condition.includes('cholesterol')) {
                    tips.push("To lower cholesterol, opt for foods high in soluble fiber like oats, flaxseeds and legumes.");
                }
            }
            
            // Tips based on fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss') {
                    tips.push("For weight loss, focus on high-protein, high-fiber Indian foods like dal, sprouts and vegetable curries with minimal oil.");
                }
                if (userPreferences.fitness_goal === 'muscle-gain') {
                    tips.push("For muscle gain, ensure adequate protein intake (1.6-2.2g per kg of body weight daily) from paneer, eggs, chicken and lentils.");
                }
                if (userPreferences.fitness_goal === 'endurance') {
                    tips.push("For endurance training, include complex carbohydrates like whole wheat roti, brown rice and oats for sustained energy.");
                }
            }
            
            // General healthy eating tips
            if (tips.length === 0) {
                tips.push("Aim for a balanced Indian diet with plenty of vegetables, dal, roti/rice in moderation and healthy fats like ghee in small quantities.");
            }
            
            return tips;
        }
    
        // Shopping cart - load from localStorage or initialize empty
        let cart = [];
        
        function loadCartFromLocalStorage() {
            try {
                const cartData = localStorage.getItem('cart');
                cart = cartData ? JSON.parse(cartData) : [];
                if (!Array.isArray(cart)) {
                    cart = [];
                }
            } catch (error) {
                console.error('Error loading cart from localStorage:', error);
                cart = [];
            }
            updateCart();
        }
        
        // Toggle cart visibility
        window.toggleCart = function() {
            const cartSidebar = document.getElementById('cart-sidebar');
            const cartOverlay = document.getElementById('cart-overlay');
            
            cartSidebar.classList.toggle('translate-x-full');
            cartOverlay.classList.toggle('hidden');
            document.body.style.overflow = cartSidebar.classList.contains('translate-x-full') ? 'auto' : 'hidden';
        }
    
        // Update cart UI
        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartHoverCount = document.getElementById('cart-hover-count');
            const cartSubtotal = document.getElementById('cart-subtotal');
            const cartTotal = document.getElementById('cart-total');
            
            // Update cart count
            const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            cartCount.textContent = totalItems;
            cartHoverCount.textContent = totalItems;
            
            // Update cart items
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500">Your cart is empty</p>
                        <button onclick="toggleCart()" class="mt-4 text-red-600 hover:text-red-500 underline">
                            Browse our menu
                        </button>
                    </div>
                `;
            } else {
                cartItemsContainer.innerHTML = '';
                cart.forEach((item, index) => {
                    if (!item || !item.id || !item.name || !item.price) {
                        console.warn('Invalid cart item:', item);
                        return;
                    }
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'flex justify-between items-center mb-4 pb-4 border-b border-amber-200';
                    cartItem.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.image || 'https://via.placeholder.com/100'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div class="ml-4">
                                <h3 class="text-sm font-medium text-gray-800">${item.name}</h3>
                                <p class="text-xs text-gray-600">₹${item.price.toFixed(2)} x ${item.quantity || 1}</p>
                                <div class="flex items-center mt-1">
                                    <button onclick="decreaseQuantity(${index})" class="text-gray-500 hover:text-red-600 text-xs" aria-label="Decrease quantity">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="mx-2 text-sm">${item.quantity || 1}</span>
                                    <button onclick="increaseQuantity(${index})" class="text-gray-500 hover:text-red-600 text-xs" aria-label="Increase quantity">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-sm font-medium text-gray-800">₹${((item.price || 0) * (item.quantity || 1)).toFixed(2)}</span>
                            <button onclick="removeFromCart(${index})" class="ml-4 text-red-500 hover:text-red-600" aria-label="Remove item">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItem);
                });
            }
            
            // Update totals
            const subtotal = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.quantity || 1)), 0);
            const deliveryFee = 30; // 30 INR delivery fee
            const total = subtotal + deliveryFee;
            
            cartSubtotal.textContent = `₹${subtotal.toFixed(2)}`;
            cartTotal.textContent = `₹${total.toFixed(2)}`;
            
            // Save to localStorage
            try {
                localStorage.setItem('cart', JSON.stringify(cart));
            } catch (error) {
                console.error('Error saving cart to localStorage:', error);
            }
        }
    
        // Add item to cart
        window.addToCart = function(item) {
            if (!item || !item.id || !item.name || typeof item.price !== 'number') {
                console.error('Invalid item:', item);
                return;
            }
            
            const existingIndex = cart.findIndex(i => i.id === item.id);
            
            if (existingIndex >= 0) {
                cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + 1;
            } else {
                cart.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    image: item.image || 'https://via.placeholder.com/100',
                    restaurant: item.restaurant || 'Unknown',
                    quantity: 1
                });
            }
            
            // Save to localStorage
            try {
                localStorage.setItem('cart', JSON.stringify(cart));
            } catch (error) {
                console.error('Error saving cart to localStorage:', error);
            }
            
            updateCart();
            showAddedToCartMessage(item.name);
        }
    
        // Show notification when item is added to cart
        function showAddedToCartMessage(itemName) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center z-50 animate-bounce';
            notification.innerHTML = `
                <i class="fas fa-check-circle mr-3 text-xl"></i>
                <div>
                    <p class="font-bold">Added to cart!</p>
                    <p class="text-sm">${itemName}</p>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
    
        // Increase item quantity in cart
        window.increaseQuantity = function(index) {
            if (index >= 0 && index < cart.length) {
                cart[index].quantity = (cart[index].quantity || 1) + 1;
                updateCart();
            }
        }
        
        // Decrease item quantity in cart
        window.decreaseQuantity = function(index) {
            if (index >= 0 && index < cart.length) {
                if (cart[index].quantity > 1) {
                    cart[index].quantity -= 1;
                } else {
                    cart.splice(index, 1);
                }
                updateCart();
            }
        }
    
        // Remove item from cart
        window.removeFromCart = function(index) {
            if (index >= 0 && index < cart.length) {
                const removedItem = cart.splice(index, 1)[0];
                
                updateCart();
                
                // Show removed notification
                const notification = document.createElement('div');
                notification.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center z-50 animate-bounce';
                notification.innerHTML = `
                    <i class="fas fa-trash mr-3 text-xl"></i>
                    <p class="font-bold">Item removed from cart</p>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }
        }
    
        // Close menu modal
        window.hideMenuModal = function() {
            document.getElementById('menu-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    
        // View restaurant menu
        window.viewRestaurantMenu = function(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId);
            if (!restaurant) {
                showError('Restaurant not found');
                return;
            }
            
            document.getElementById('menu-restaurant-name').textContent = restaurant.name;
            document.getElementById('menu-restaurant-cuisine').textContent = restaurant.cuisine.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ');
            
            const menuSections = document.getElementById('menu-sections');
            menuSections.innerHTML = '';
            
            if (!restaurant.menu || Object.keys(restaurant.menu).length === 0) {
                menuSections.innerHTML = '<p class="text-gray-500">No menu items available for this restaurant.</p>';
                document.getElementById('menu-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                return;
            }
            
            for (const [sectionName, items] of Object.entries(restaurant.menu)) {
                if (!Array.isArray(items)) continue;
                
                const section = document.createElement('div');
                section.className = 'menu-section';
                
                // Filter and sort items based on user preferences
                const filteredItems = items
                    .filter(item => item && item.id && item.name && typeof item.price === 'number')
                    .map(item => {
                        // Calculate match score for each item
                        const matchInfo = calculateFoodMatchScore(item, restaurant);
                        return {
                            ...item,
                            image: item.image || 'https://via.placeholder.com/100',
                            matchScore: matchInfo.score,
                            matchReasons: matchInfo.reasons
                        };
                    })
                    .filter(item => item.matchScore > 0) // Only show items with some match
                    .sort((a, b) => b.matchScore - a.matchScore); // Sort by best match first
                
                if (filteredItems.length === 0) continue;
                
                section.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">${sectionName}</h3>
                    <div class="space-y-4">
                        ${filteredItems.map(item => `
                            <div class="flex items-start relative">
                                <div class="w-20 h-20 bg-amber-50 rounded-md overflow-hidden flex-shrink-0 border border-amber-200">
                                    <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                                    <div class="match-score ${getMatchScoreClass(item.matchScore)}">
                                        ${item.matchScore}
                                    </div>
                                </div>
                                <div class="ml-4 flex-grow">
                                    <h4 class="font-medium text-gray-800">${item.name}</h4>
                                    <p class="text-sm text-gray-600 mt-1">${item.description || 'No description available'}</p>
                                    <div class="mt-2 flex flex-wrap">
                                        ${item.matchReasons.map(reason => 
                                            `<span class="diet-badge ${reason.class}">${reason.text}</span>`
                                        ).join('')}
                                    </div>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="font-medium text-red-600">₹${item.price.toFixed(2)}</span>
                                        <button onclick="addToCart(${JSON.stringify({
                                            id: item.id,
                                            name: item.name,
                                            price: item.price,
                                            image: item.image,
                                            restaurant: restaurant.name
                                        }).replace(/"/g, '&quot;')})" class="text-sm bg-gradient-to-r from-red-600 to-amber-600 text-white py-1 px-3 rounded hover:from-red-700 hover:to-amber-700 transition btn-shine">
                                            Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                menuSections.appendChild(section);
            }
            
            document.getElementById('menu-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
    
        // Get CSS class for match score display
        function getMatchScoreClass(score) {
            if (score >= 8) return 'high';
            if (score >= 5) return 'medium';
            return 'low';
        }
    
        // Calculate how well a food item matches user preferences
        function calculateFoodMatchScore(foodItem, restaurant) {
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                return { score: 5, reasons: [] }; // Neutral score if no preferences
            }
            
            let score = 5; // Base score
            const reasons = [];
            
            // 1. Check dietary restrictions (strict filters - if these don't match, score should be 0)
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && !isVegetarian(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('vegan') && !isVegan(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('gluten-free') && !isGlutenFree(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('halal') && !isHalal(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('jain') && !isJain(foodItem, restaurant)) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 2. Check allergies (strict filter)
            if (userPreferences.allergy) {
                if (hasAllergens(foodItem, userPreferences.allergy)) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 3. Add points for matching dietary preferences
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && isVegetarian(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Vegetarian', class: 'vegetarian' });
                }
                if (userPreferences.diet.includes('vegan') && isVegan(foodItem, restaurant)) {
                    score += 1.5;
                    reasons.push({ text: 'Vegan', class: 'vegan' });
                }
                if (userPreferences.diet.includes('gluten-free') && isGlutenFree(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Gluten-Free', class: 'gluten-free' });
                }
                if (userPreferences.diet.includes('jain') && isJain(foodItem, restaurant)) {
                    score += 1;
                    reasons.push({ text: 'Jain', class: 'vegetarian' });
                }
            }
            
            // 4. Add points for matching meal preferences
            if (userPreferences.meal_pref) {
                if (userPreferences.meal_pref.includes('high-protein') && isHighProtein(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'High Protein', class: 'high-protein' });
                }
                if (userPreferences.meal_pref.includes('low-carb') && isLowCarb(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Low Carb', class: 'low-carb' });
                }
                if (userPreferences.meal_pref.includes('keto') && isKeto(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Keto', class: 'keto' });
                }
                if (userPreferences.meal_pref.includes('balanced') && isBalanced(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Balanced', class: 'balanced' });
                }
            }
            
            // 5. Adjust for health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes') && isDiabetesFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Diabetes-Friendly', class: 'diabetes-friendly' });
                }
                if (userPreferences.health_condition.includes('hypertension') && isLowSodium(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Low Sodium', class: 'heart-healthy' });
                }
                if (userPreferences.health_condition.includes('heart-disease') && isHeartHealthy(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Heart Healthy', class: 'heart-healthy' });
                }
                if (userPreferences.health_condition.includes('cholesterol') && isCholesterolFriendly(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Cholesterol-Friendly', class: 'heart-healthy' });
                }
            }
            
            // 6. Adjust for fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss' && isWeightLossFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Weight Loss', class: 'weight-loss' });
                }
                if (userPreferences.fitness_goal === 'muscle-gain' && isMuscleGainFriendly(foodItem)) {
                    score += 1.5;
                    reasons.push({ text: 'Muscle Gain', class: 'muscle-gain' });
                }
                if (userPreferences.fitness_goal === 'endurance' && isEnduranceFriendly(foodItem)) {
                    score += 1;
                    reasons.push({ text: 'Endurance', class: 'balanced' });
                }
            }
            
            // Cap score at 10
            score = Math.min(10, Math.round(score * 10) / 10);
            
            return { score, reasons };
        }
    
        // Food classification functions
        function isVegetarian(foodItem, restaurant) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const nonVegKeywords = ['chicken', 'meat', 'beef', 'pork', 'fish', 'seafood', 'shrimp', 'lamb', 'mutton', 'egg'];
            return !nonVegKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isVegan(foodItem, restaurant) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const nonVeganKeywords = ['cheese', 'milk', 'butter', 'cream', 'yogurt', 'honey', 'egg', 'paneer', 'ghee', 'dahi'];
            return isVegetarian(foodItem, restaurant) && 
                   !nonVeganKeywords.some(keyword => 
                       foodItem.name.toLowerCase().includes(keyword) || 
                       foodItem.description.toLowerCase().includes(keyword)
                   );
        }
    
        function isGlutenFree(foodItem, restaurant) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const glutenKeywords = ['wheat', 'bread', 'pasta', 'flour', 'barley', 'rye', 'soy sauce', 'maida', 'atta', 'besan'];
            return !glutenKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isHalal(foodItem, restaurant) {
            if (!restaurant) return false;
            return restaurant.cuisine.includes('halal') || 
                   restaurant.name.toLowerCase().includes('halal');
        }
    
        function isJain(foodItem, restaurant) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const jainRestricted = ['onion', 'garlic', 'potato', 'carrot', 'radish', 'beetroot'];
            return isVegetarian(foodItem, restaurant) && 
                   !jainRestricted.some(keyword => 
                       foodItem.name.toLowerCase().includes(keyword) || 
                       foodItem.description.toLowerCase().includes(keyword)
                   );
        }
    
        function hasAllergens(foodItem, userAllergies) {
            if (!foodItem || !foodItem.name || !foodItem.description || !userAllergies) return false;
            
            const allergenMap = {
                'nuts': ['nut', 'almond', 'peanut', 'cashew', 'pistachio', 'walnut', 'kaju', 'badam'],
                'dairy': ['milk', 'cheese', 'butter', 'cream', 'yogurt', 'paneer', 'ghee', 'dahi'],
                'gluten': ['wheat', 'bread', 'pasta', 'flour', 'barley', 'rye', 'maida', 'atta'],
                'shellfish': ['shrimp', 'prawn', 'crab', 'lobster', 'shellfish', 'jhinga'],
                'soy': ['soy', 'tofu', 'soya', 'edamame'],
                'eggs': ['egg', 'mayo', 'mayonnaise', 'anda']
            };
            
            return userAllergies.some(allergy => {
                const keywords = allergenMap[allergy] || [];
                return keywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            });
        }
    
        function isHighProtein(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const proteinKeywords = ['chicken', 'fish', 'tofu', 'beans', 'lentils', 'protein', 'steak', 'egg', 'paneer', 'dal', 'chana', 'rajma', 'sprouts'];
            return proteinKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isLowCarb(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const carbKeywords = ['rice', 'pasta', 'bread', 'potato', 'noodle', 'sugar', 'roti', 'naan', 'paratha', 'poori'];
            return !carbKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isKeto(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const ketoKeywords = ['keto', 'high-fat', 'avocado', 'cheese', 'butter', 'ghee', 'paneer'];
            const nonKetoKeywords = ['sugar', 'bread', 'pasta', 'rice', 'potato', 'roti', 'naan'];
            
            return (ketoKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   !nonKetoKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword))
            );
        }
    
        function isBalanced(foodItem) {
            if (!foodItem || !foodItem.description) return false;
            
            const hasProtein = isHighProtein(foodItem);
            const hasVeggies = ['vegetable', 'salad', 'greens', 'spinach', 'kale', 'sabzi', 'bhaji'].some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
            const hasHealthyCarbs = ['quinoa', 'brown rice', 'whole grain', 'bajra', 'jowar'].some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
            
            return hasProtein && (hasVeggies || hasHealthyCarbs);
        }
    
        function isDiabetesFriendly(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const badKeywords = ['sugar', 'syrup', 'juice', 'white rice', 'white bread', 'maida', 'fried', 'ghee'];
            const goodKeywords = ['high-fiber', 'whole grain', 'vegetable', 'protein', 'multigrain', 'bajra'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
        }
    
        function isLowSodium(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const highSodiumKeywords = ['soy sauce', 'processed', 'canned', 'pickle', 'bacon', 'sausage', 'papad', 'chutney'];
            return !highSodiumKeywords.some(keyword => 
                foodItem.name.toLowerCase().includes(keyword) || 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
        function isHeartHealthy(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const badKeywords = ['fried', 'cream', 'butter', 'fatty', 'ghee', 'malai'];
            const goodKeywords = ['omega-3', 'salmon', 'avocado', 'olive oil', 'nuts', 'flaxseed'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isCholesterolFriendly(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const badKeywords = ['fried', 'fatty', 'cream', 'butter', 'cheese', 'ghee'];
            const goodKeywords = ['fiber', 'oat', 'beans', 'lentil', 'vegetable', 'whole grain'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isWeightLossFriendly(foodItem) {
            if (!foodItem || !foodItem.name || !foodItem.description) return false;
            
            const badKeywords = ['fried', 'cream', 'cheese', 'sugar', 'syrup', 'ghee', 'malai'];
            const goodKeywords = ['lean', 'grilled', 'steamed', 'vegetable', 'salad', 'sprouts'];
            
            return !badKeywords.some(keyword => 
                    foodItem.name.toLowerCase().includes(keyword) || 
                    foodItem.description.toLowerCase().includes(keyword)) &&
                   goodKeywords.some(keyword => 
                    foodItem.description.toLowerCase().includes(keyword)
                );
            
        }
    
        function isMuscleGainFriendly(foodItem) {
            return isHighProtein(foodItem);
        }
    
        function isEnduranceFriendly(foodItem) {
            if (!foodItem || !foodItem.description) return false;
            
            const carbKeywords = ['whole grain', 'brown rice', 'quinoa', 'potato', 'oat', 'bajra', 'jowar'];
            return carbKeywords.some(keyword => 
                foodItem.description.toLowerCase().includes(keyword)
            );
        }
    
         // Sample restaurant data with healthy Indian food options
         const restaurants = [
            {
                id: 1,
                name: "Green Bites - Healthy Indian Cuisine",
                cuisine: ["vegetarian", "healthy", "indian", "halal"],
                rating: 4.6,
                reviewCount: 320,
                description: "Specializing in fresh, organic Indian meals with plenty of vegetarian and vegan options.",
                image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                recommended: true,
                menu: {
                    "Healthy Breakfast": [
                        { id: 101, name: "Moong Dal Chilla", description: "Protein-rich pancakes made from moong dal with minimal oil. Served with mint chutney.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2021/03/Moong-Dal-Chilla-2-3.jpg" },
                        { id: 102, name: "Bajra Roti with Lauki Sabzi", description: "Nutritious pearl millet roti with bottle gourd vegetable curry.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Roti-2-3.jpg" },
                        { id: 103, name: "Sprouts Chaat", description: "Healthy sprouted moong beans with onions, tomatoes and spices.", price: 110, image: "https://www.whiskaffair.com/wp-content/uploads/2020/12/Sprouts-Chaat-2-3.jpg" },
                        { id: 104, name: "Oats Poha", description: "Light breakfast made with oats, peanuts and vegetables.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Poha-2-3.jpg" },
                        { id: 105, name: "Besan Chilla", description: "Gram flour pancakes stuffed with vegetables and spices.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Besan-Chilla-2-3.jpg" }
                    ],
                    "Soups & Salads": [
                        { id: 201, name: "Dal Shorba", description: "Light lentil soup with Indian spices, rich in protein and fiber.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-Shorba-2-3.jpg" },
                        { id: 202, name: "Quinoa Salad", description: "Organic quinoa with fresh vegetables and lemon dressing. High in fiber and protein.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Quinoa-Salad-2-3.jpg" },
                        { id: 203, name: "Sprouts Salad", description: "Healthy sprouted beans with cucumbers, tomatoes and lemon.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Salad-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 301, name: "Jowar Roti with Dal", description: "Sorghum flour roti with protein-rich lentil curry.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Roti-2-3.jpg" },
                        { id: 302, name: "Brown Rice with Rajma", description: "Whole grain brown rice with kidney bean curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Rajma-2-3.jpg" },
                        { id: 303, name: "Palak Paneer with Multigrain Roti", description: "Spinach curry with cottage cheese and multigrain flatbread.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Palak-Paneer-2-3.jpg" }
                    ],
                    "Healthy Desserts": [
                        { id: 401, name: "Dates Ladoo", description: "Sweet balls made from dates and nuts without added sugar.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dates-Ladoo-2-3.jpg" },
                        { id: 402, name: "Makhana Kheer", description: "Light pudding made from fox nuts and low-fat milk.", price: 100, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Makhana-Kheer-2-3.jpg" }
                    ]
                }
            },
            {
                id: 2,
                name: "Organic Indian Delights",
                cuisine: ["organic", "gluten-free", "vegan", "indian"],
                rating: 4.7,
                reviewCount: 280,
                description: "100% organic Indian ingredients with gluten-free and vegan options.",
                image: "https://images.unsplash.com/photo-1631515243349-e0cb75fb8d3a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1188&q=80",
                recommended: true,
                menu: {
                    "Organic Breakfast": [
                        { id: 501, name: "Ragi Dosa", description: "Dosa made with finger millet flour, rich in calcium.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" },
                        { id: 502, name: "Jowar Upma", description: "Healthy upma made with sorghum instead of semolina.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Upma-2-3.jpg" }
                    ],
                    "Organic Bowls": [
                        { id: 601, name: "Bajra Khichdi", description: "Pearl millet and moong dal porridge with vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Khichdi-2-3.jpg" },
                        { id: 602, name: "Quinoa Pulao", description: "Protein-rich quinoa cooked with Indian spices and vegetables.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Quinoa-Pulao-2-3.jpg" }
                    ],
                    "Organic Main Course": [
                        { id: 701, name: "Kuttu Roti with Lauki Sabzi", description: "Buckwheat flatbread with bottle gourd curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kuttu-Roti-2-3.jpg" },
                        { id: 702, name: "Samak Rice with Kadhi", description: "Barnyard millet with yogurt-based curry.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Samak-Rice-2-3.jpg" }
                    ]
                }
            },
            {
                id: 3,
                name: "Fit & Fresh - Indian Protein Kitchen",
                cuisine: ["healthy", "protein", "balanced", "indian"],
                rating: 4.5,
                reviewCount: 210,
                description: "Nutritionist-designed Indian meals for fitness enthusiasts.",
                image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1071&q=80",
                menu: {
                    "Protein Breakfast": [
                        { id: 801, name: "Paneer Bhurji with Multigrain Roti", description: "Scrambled cottage cheese with whole grain flatbread.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Bhurji-2-3.jpg" },
                        { id: 802, name: "Egg Bhurji with Jowar Roti", description: "Scrambled eggs with sorghum flatbread.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Egg-Bhurji-2-3.jpg" }
                    ],
                    "Protein Meals": [
                        { id: 901, name: "Grilled Chicken with Quinoa", description: "Lean chicken with protein-rich quinoa and vegetables.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Chicken-2-3.jpg" },
                        { id: 902, name: "Soya Chunks Curry with Brown Rice", description: "High-protein soy chunks in gravy with whole grain rice.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Soya-Chunks-Curry-2-3.jpg" }
                    ],
                    "Protein Shakes": [
                        { id: 1001, name: "Muscle Builder Shake", description: "Whey protein with banana, peanut butter and almond milk.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Protein-Shake-2-3.jpg" },
                        { id: 1002, name: "Vegan Protein Shake", description: "Plant-based protein with almond milk and berries.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Protein-Shake-2-3.jpg" }
                    ]
                }
            },
            {
                id: 4,
                name: "Vegan Indian Kitchen",
                cuisine: ["vegan", "plant-based", "organic", "indian"],
                rating: 4.6,
                reviewCount: 190,
                description: "100% plant-based Indian meals made with organic ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Vegan Breakfast": [
                        { id: 1101, name: "Sabudana Khichdi", description: "Tapioca pearls cooked with peanuts and spices.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sabudana-Khichdi-2-3.jpg" },
                        { id: 1102, name: "Ragi Dosa with Coconut Chutney", description: "Finger millet crepes with coconut dip.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" }
                    ],
                    "Plant-Based Mains": [
                        { id: 1201, name: "Vegan Thali", description: "Complete meal with dal, sabzi, roti, rice and salad.", price: 250, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Thali-2-3.jpg" },
                        { id: 1202, name: "Lentil Curry with Brown Rice", description: "Organic lentils with whole grain rice.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Lentil-Curry-2-3.jpg" }
                    ],
                    "Healthy Sides": [
                        { id: 1301, name: "Sweet Potato Fries", description: "Baked sweet potato fries with herbs.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sweet-Potato-Fries-2-3.jpg" },
                        { id: 1302, name: "Kale Chips", description: "Crispy baked kale with sea salt.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kale-Chips-2-3.jpg" }
                    ]
                }
            },
            {
                id: 5,
                name: "South Indian Healthy Kitchen",
                cuisine: ["south indian", "vegetarian", "healthy"],
                rating: 4.4,
                reviewCount: 175,
                description: "Authentic South Indian cuisine with healthy options.",
                image: "https://images.unsplash.com/photo-1631515243349-e0cb75fb8d3a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1188&q=80",
                recommended: true,
                menu: {
                    "Healthy Dosas": [
                        { id: 1401, name: "Ragi Dosa", description: "Dosa made with ragi flour, rich in calcium and fiber.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Dosa-2-3.jpg" },
                        { id: 1402, name: "Multigrain Dosa", description: "Dosa made with a blend of healthy grains.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Multigrain-Dosa-2-3.jpg" }
                    ],
                    "Healthy Idlis": [
                        { id: 1501, name: "Oats Idli", description: "Steamed cakes made with oats and lentils.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Idli-2-3.jpg" },
                        { id: 1502, name: "Ragi Idli", description: "Nutritious idlis made with finger millet.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Idli-2-3.jpg" }
                    ],
                    "Healthy Sides": [
                        { id: 1601, name: "Sambar", description: "Lentil-based vegetable stew with minimal oil.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sambar-2-3.jpg" },
                        { id: 1602, name: "Coconut Chutney", description: "Fresh coconut chutney with minimal oil.", price: 50, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Coconut-Chutney-2-3.jpg" }
                    ]
                }
            },
            {
                id: 6,
                name: "North Indian Healthy Bites",
                cuisine: ["north indian", "vegetarian", "healthy"],
                rating: 4.3,
                reviewCount: 195,
                description: "Traditional North Indian cuisine with a healthy twist.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Starters": [
                        { id: 1701, name: "Baked Samosa", description: "Whole wheat samosas with healthy fillings. Lower fat than traditional.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Samosa-2-3.jpg" },
                        { id: 1702, name: "Sprouts Chaat", description: "Healthy sprouts with Indian spices. High in protein and fiber.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Chaat-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 1801, name: "Dal Tadka", description: "Protein-rich lentils with minimal oil. Comfort food made healthy.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-Tadka-2-3.jpg" },
                        { id: 1802, name: "Paneer Tikka", description: "Grilled cottage cheese with veggies. High protein vegetarian option.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Tikka-2-3.jpg" }
                    ],
                    "Healthy Breads": [
                        { id: 1901, name: "Bajra Roti", description: "Pearl millet flatbread rich in fiber.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Bajra-Roti-2-3.jpg" },
                        { id: 1902, name: "Jowar Roti", description: "Sorghum flatbread packed with nutrients.", price: 60, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jowar-Roti-2-3.jpg" }
                    ]
                }
            },
            {
                id: 7,
                name: "Keto Indian Kitchen",
                cuisine: ["keto", "low-carb", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 160,
                description: "Delicious keto-friendly Indian meals that keep you in ketosis.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Keto Breakfast": [
                        { id: 2001, name: "Keto Poha", description: "Low-carb poha made with cauliflower and nuts.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Poha-2-3.jpg" },
                        { id: 2002, name: "Keto Dosa", description: "Dosa made with almond flour and coconut flour.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Dosa-2-3.jpg" }
                    ],
                    "Keto Specials": [
                        { id: 2101, name: "Keto Butter Chicken", description: "Chicken in creamy tomato gravy without sugar.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Keto-Butter-Chicken-2-3.jpg" },
                        { id: 2102, name: "Cauliflower Rice Biryani", description: "Biryani made with cauliflower rice instead of regular rice.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Cauliflower-Rice-Biryani-2-3.jpg" }
                    ]
                }
            },
            {
                id: 8,
                name: "Diabetic Friendly Kitchen",
                cuisine: ["diabetes-friendly", "low-sugar", "healthy", "indian"],
                rating: 4.4,
                reviewCount: 140,
                description: "Indian meals specially designed for diabetics with low glycemic index.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Diabetic Breakfast": [
                        { id: 2201, name: "Besan Chilla", description: "Gram flour pancakes with vegetables, no sugar added.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Besan-Chilla-2-3.jpg" },
                        { id: 2202, name: "Moong Dal Cheela", description: "Protein-rich pancakes made from split green gram.", price: 160, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Moong-Dal-Cheela-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 2301, name: "Multigrain Roti with Lauki Sabzi", description: "Fiber-rich roti with bottle gourd curry.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Multigrain-Roti-2-3.jpg" },
                        { id: 2302, name: "Brown Rice with Dal", description: "Whole grain rice with lentil curry.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Brown-Rice-2-3.jpg" }
                    ]
                }
            },
            {
                id: 9,
                name: "Heart Healthy Indian Meals",
                cuisine: ["heart-healthy", "low-fat", "healthy", "indian"],
                rating: 4.3,
                reviewCount: 125,
                description: "Indian meals low in saturated fats and cholesterol for heart health.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Heart Healthy Breakfast": [
                        { id: 2401, name: "Oats Upma", description: "Healthy upma made with oats and vegetables.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Oats-Upma-2-3.jpg" },
                        { id: 2402, name: "Poha with Peanuts", description: "Flattened rice with peanuts and minimal oil.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Poha-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 2501, name: "Grilled Fish with Steamed Vegetables", description: "Omega-3 rich fish with fiber-rich vegetables.", price: 280, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Fish-2-3.jpg" },
                        { id: 2502, name: "Dal with Brown Rice", description: "Protein-rich lentils with whole grain rice.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dal-2-3.jpg" }
                    ]
                }
            },
            {
                id: 10,
                name: "Weight Loss Indian Meals",
                cuisine: ["weight-loss", "low-calorie", "healthy", "indian"],
                rating: 4.4,
                reviewCount: 180,
                description: "Delicious Indian meals under 500 calories for weight management.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Low-Calorie Breakfast": [
                        { id: 2601, name: "Vegetable Daliya", description: "Broken wheat porridge with vegetables.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegetable-Daliya-2-3.jpg" },
                        { id: 2602, name: "Ragi Porridge", description: "Finger millet porridge with nuts.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ragi-Porridge-2-3.jpg" }
                    ],
                    "Low-Calorie Meals": [
                        { id: 2701, name: "Vegetable Khichdi", description: "Light rice and lentil dish with vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegetable-Khichdi-2-3.jpg" },
                        { id: 2702, name: "Grilled Chicken with Salad", description: "Lean protein with fresh vegetables.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Chicken-Salad-2-3.jpg" }
                    ]
                }
            },
            {
                id: 11,
                name: "Muscle Gain Indian Kitchen",
                cuisine: ["high-protein", "healthy", "balanced", "indian"],
                rating: 4.6,
                reviewCount: 210,
                description: "High-protein Indian meals for muscle building and recovery.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Protein Plates": [
                        { id: 2801, name: "Egg Curry with Brown Rice", description: "Protein-rich eggs in gravy with whole grain rice.", price: 220, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Egg-Curry-2-3.jpg" },
                        { id: 2802, name: "Paneer Bhurji with Multigrain Roti", description: "Scrambled cottage cheese with fiber-rich flatbread.", price: 240, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Paneer-Bhurji-2-3.jpg" }
                    ],
                    "Protein Shakes": [
                        { id: 2901, name: "Mass Gainer Shake", description: "Whey protein with banana, oats and milk.", price: 200, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Protein-Shake-2-3.jpg" },
                        { id: 2902, name: "Vegan Mass Gainer", description: "Plant-based protein with almond milk and dates.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Vegan-Protein-Shake-2-3.jpg" }
                    ]
                }
            },
            {
                id: 12,
                name: "Jain Healthy Kitchen",
                cuisine: ["jain", "vegetarian", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 170,
                description: "Traditional Jain cuisine with healthy options without onion and garlic.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Jain Breakfast": [
                        { id: 3001, name: "Jain Poha", description: "Flattened rice without onion and garlic.", price: 140, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Poha-2-3.jpg" },
                        { id: 3002, name: "Jain Dosa", description: "Lentil and rice crepes without onion and garlic.", price: 160, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Dosa-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 3101, name: "Jain Dal Fry with Rice", description: "Lentil curry without onion and garlic.", price: 190, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Dal-Fry-2-3.jpg" },
                        { id: 3102, name: "Jain Sabzi with Roti", description: "Vegetable curry without root vegetables.", price: 180, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Jain-Sabzi-2-3.jpg" }
                    ]
                }
            },
            {
                id: 13,
                name: "Ayurvedic Indian Kitchen",
                cuisine: ["ayurvedic", "healthy", "balanced", "indian"],
                rating: 4.4,
                reviewCount: 150,
                description: "Traditional Indian meals prepared according to Ayurvedic principles.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Ayurvedic Breakfast": [
                        { id: 3201, name: "Kitchari", description: "Balancing meal of rice and mung beans with spices.", price: 170, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Kitchari-2-3.jpg" },
                        { id: 3202, name: "Herbal Tea with Millets", description: "Detoxifying tea with nutritious millets.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Herbal-Tea-2-3.jpg" }
                    ],
                    "Main Course": [
                        { id: 3301, name: "Tridoshic Thali", description: "Balanced meal for all body types according to Ayurveda.", price: 250, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Tridoshic-Thali-2-3.jpg" },
                        { id: 3302, name: "Ayurvedic Kadha", description: "Immunity-boosting herbal drink.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Ayurvedic-Kadha-2-3.jpg" }
                    ]
                }
            },
            {
                id: 14,
                name: "Healthy Indian Street Food",
                cuisine: ["street food", "healthy", "indian"],
                rating: 4.3,
                reviewCount: 230,
                description: "Your favorite Indian street food made healthy with less oil and fresh ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Street Snacks": [
                        { id: 3401, name: "Baked Vada Pav", description: "Mumbai's favorite snack made healthy by baking instead of frying.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Vada-Pav-2-3.jpg" },
                        { id: 3402, name: "Grilled Paneer Tikka", description: "Cottage cheese marinated and grilled instead of fried.", price: 150, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Grilled-Paneer-Tikka-2-3.jpg" }
                    ],
                    "Healthy Chats": [
                        { id: 3501, name: "Baked Samosa Chaat", description: "Baked samosas topped with healthy chutneys and yogurt.", price: 130, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Baked-Samosa-Chaat-2-3.jpg" },
                        { id: 3502, name: "Sprouts Bhel", description: "Healthy bhel made with sprouts instead of puffed rice.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sprouts-Bhel-2-3.jpg" }
                    ]
                }
            },
            {
                id: 15,
                name: "Healthy Indian Desserts",
                cuisine: ["desserts", "healthy", "indian"],
                rating: 4.5,
                reviewCount: 180,
                description: "Traditional Indian desserts made healthy with less sugar and healthy ingredients.",
                image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                menu: {
                    "Healthy Sweets": [
                        { id: 3601, name: "Dates and Nuts Ladoo", description: "Sweet balls made from dates and nuts without added sugar.", price: 100, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Dates-Ladoo-2-3.jpg" },
                        { id: 3602, name: "Sugar-free Gajar Halwa", description: "Carrot pudding sweetened with dates.", price: 120, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sugar-free-Gajar-Halwa-2-3.jpg" }
                    ],
                    "Healthy Drinks": [
                        { id: 3701, name: "Sugar-free Thandai", description: "Traditional drink made with nuts and spices, no sugar added.", price: 90, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Sugar-free-Thandai-2-3.jpg" },
                        { id: 3702, name: "Low-fat Lassi", description: "Yogurt drink made with low-fat yogurt.", price: 80, image: "https://www.whiskaffair.com/wp-content/uploads/2020/04/Low-fat-Lassi-2-3.jpg" }
                    ]
                }
            }
        ];
    
        // Load restaurants with personalized recommendations
        function loadRestaurants() {
            const recommendedContainer = document.getElementById('recommended-restaurants');
            const allContainer = document.getElementById('all-restaurants');
            const noRecsMessage = document.getElementById('no-recommendations');
            
            recommendedContainer.innerHTML = '';
            allContainer.innerHTML = '';
            
            // Filter and sort restaurants based on user preferences
            let recommendedRestaurants = [];
            let otherRestaurants = [];
            
            restaurants.forEach(restaurant => {
                // Calculate match score for each restaurant
                const matchInfo = calculateRestaurantMatchScore(restaurant);
                
                if (matchInfo.score >= 7) { // Threshold for "recommended"
                    recommendedRestaurants.push({
                        ...restaurant,
                        matchScore: matchInfo.score,
                        matchReasons: matchInfo.reasons
                    });
                } else {
                    otherRestaurants.push(restaurant);
                }
            });
            
            // Sort recommended restaurants by match score
            recommendedRestaurants.sort((a, b) => b.matchScore - a.matchScore);
            
            // Display recommended restaurants
            if (recommendedRestaurants.length > 0) {
                noRecsMessage.classList.add('hidden');
                recommendedRestaurants.forEach(restaurant => {
                    const restaurantCard = createRestaurantCard(restaurant, true);
                    recommendedContainer.appendChild(restaurantCard);
                });
            } else {
                noRecsMessage.classList.remove('hidden');
            }
            
            // Display all other restaurants
            otherRestaurants.forEach(restaurant => {
                const restaurantCard = createRestaurantCard(restaurant, false);
                allContainer.appendChild(restaurantCard);
            });
        }
    
        // Calculate how well a restaurant matches user preferences
        function calculateRestaurantMatchScore(restaurant) {
            if (!userPreferences || Object.keys(userPreferences).length === 0) {
                return { score: 0, reasons: [] }; // No score if no preferences
            }
            
            let score = 0;
            const reasons = [];
            
            // 1. Check dietary restrictions (strict filters)
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && !restaurant.cuisine.includes('vegetarian')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('vegan') && !restaurant.cuisine.includes('vegan')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('gluten-free') && !restaurant.cuisine.includes('gluten-free')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('halal') && !restaurant.cuisine.includes('halal')) {
                    return { score: 0, reasons: [] };
                }
                if (userPreferences.diet.includes('jain') && !restaurant.cuisine.includes('jain')) {
                    return { score: 0, reasons: [] };
                }
            }
            
            // 2. Add points for matching dietary preferences
            if (userPreferences.diet) {
                if (userPreferences.diet.includes('vegetarian') && restaurant.cuisine.includes('vegetarian')) {
                    score += 2;
                    reasons.push('Vegetarian options');
                }
                if (userPreferences.diet.includes('vegan') && restaurant.cuisine.includes('vegan')) {
                    score += 3;
                    reasons.push('Vegan options');
                }
                if (userPreferences.diet.includes('gluten-free') && restaurant.cuisine.includes('gluten-free')) {
                    score += 2;
                    reasons.push('Gluten-free options');
                }
                if (userPreferences.diet.includes('jain') && restaurant.cuisine.includes('jain')) {
                    score += 2;
                    reasons.push('Jain options');
                }
            }
            
            // 3. Add points for matching meal preferences
            if (userPreferences.meal_pref) {
                if (userPreferences.meal_pref.includes('high-protein') && restaurant.cuisine.includes('protein')) {
                    score += 2;
                    reasons.push('High-protein options');
                }
                if (userPreferences.meal_pref.includes('low-carb') && restaurant.cuisine.includes('low-carb')) {
                    score += 2;
                    reasons.push('Low-carb options');
                }
                if (userPreferences.meal_pref.includes('keto') && restaurant.cuisine.includes('keto')) {
                    score += 1;
                    reasons.push('Keto options');
                }
                if (userPreferences.meal_pref.includes('balanced') && restaurant.cuisine.includes('balanced')) {
                    score += 1;
                    reasons.push('Balanced meals');
                }
            }
            
            // 4. Adjust for health conditions
            if (userPreferences.health_condition) {
                if (userPreferences.health_condition.includes('diabetes') && restaurant.cuisine.includes('diabetes-friendly')) {
                    score += 1.5;
                    reasons.push('Diabetes-friendly');
                }
                if (userPreferences.health_condition.includes('hypertension') && restaurant.cuisine.includes('low-sodium')) {
                    score += 1;
                    reasons.push('Low-sodium options');
                }
                if (userPreferences.health_condition.includes('heart-disease') && restaurant.cuisine.includes('heart-healthy')) {
                    score += 1;
                    reasons.push('Heart-healthy');
                }
            }
            
            // 5. Adjust for fitness goals
            if (userPreferences.fitness_goal) {
                if (userPreferences.fitness_goal === 'weight-loss' && restaurant.cuisine.includes('weight-loss')) {
                    score += 2;
                    reasons.push('Weight-loss friendly');
                }
                if (userPreferences.fitness_goal === 'muscle-gain' && restaurant.cuisine.includes('high-protein')) {
                    score += 2;
                    reasons.push('Muscle-gain friendly');
                }
            }
            
            // Cap score at 10
            score = Math.min(10, Math.round(score * 10) / 10);
            
            return { score, reasons };
        }
    
        // Create restaurant card HTML
        function createRestaurantCard(restaurant, isRecommended) {
            const restaurantCard = document.createElement('div');
            restaurantCard.className = 'bg-white p-6 rounded-xl hover:bg-amber-50 transition-all duration-300 card-hover border-animate shadow-md';
            
            let matchScoreHTML = '';
            let reasonsHTML = '';
            
            if (isRecommended && restaurant.matchScore) {
                matchScoreHTML = `
                    <div class="match-score ${getMatchScoreClass(restaurant.matchScore)}">
                        ${restaurant.matchScore}
                    </div>
                `;
                
                if (restaurant.matchReasons && restaurant.matchReasons.length > 0) {
                    reasonsHTML = `
                        <div class="mt-2 flex flex-wrap">
                            ${restaurant.matchReasons.map(reason => 
                                `<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded mr-2 mb-2">${reason}</span>`
                            ).join('')}
                        </div>
                    `;
                }
            }
            
            restaurantCard.innerHTML = `
                <div class="relative">
                    <img class="w-full h-48 object-cover rounded-lg mb-4" src="${restaurant.image}" alt="${restaurant.name}">
                    ${matchScoreHTML}
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">${restaurant.name}</h3>
                <div class="flex items-center mb-3">
                    <div class="flex text-yellow-400">
                        ${'<i class="fas fa-star"></i>'.repeat(Math.floor(restaurant.rating))}
                        ${restaurant.rating % 1 >= 0.5 ? '<i class="fas fa-star-half-alt"></i>' : ''}
                    </div>
                    <span class="ml-2 text-sm text-gray-600">(${restaurant.reviewCount} reviews)</span>
                </div>
                <div class="flex flex-wrap gap-2 mb-3">
                    ${restaurant.cuisine.map(cuisine => 
                        `<span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded">${cuisine.charAt(0).toUpperCase() + cuisine.slice(1)}</span>`
                    ).join('')}
                </div>
                <p class="text-sm text-gray-600 mb-4">${restaurant.description}</p>
                ${reasonsHTML}
                <button onclick="viewRestaurantMenu(${restaurant.id})" class="w-full bg-gradient-to-r from-red-600 to-amber-600 text-white py-2 rounded-lg hover:from-red-700 hover:to-amber-700 transition btn-shine">
                    View Menu
                </button>
            `;
            
            return restaurantCard;
        }
        
        // Show error message
        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            const errorMessage = document.getElementById('error-message-text');
            
            if (errorContainer && errorMessage) {
                errorMessage.textContent = message;
                errorContainer.classList.remove('hidden');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorContainer.classList.add('hidden');
                }, 5000);
            }
        }
        
        // Show loading indicator
        function showLoading() {
            document.getElementById('loading-indicator').classList.remove('hidden');
        }
        
        // Hide loading indicator
        function hideLoading() {
            document.getElementById('loading-indicator').classList.add('hidden');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Setup Firebase auth listener
            setupAuthListener();
            
            // Load cart from localStorage
            loadCartFromLocalStorage();
            
            // Add smooth transition to all links
            document.querySelectorAll('a[href^="#"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.body.style.opacity = '0';
                    document.body.style.transition = 'opacity 0.3s ease';
                    
                    setTimeout(() => {
                        window.location.href = this.href;
                    }, 300);
                });
            });
            
            // Search functionality
            const searchInput = document.getElementById('restaurant-search');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterRestaurants();
                });
            }
            
            // Filter functionality
            const cuisineFilter = document.getElementById('cuisine-filter');
            const dietFilter = document.getElementById('diet-filter');
            
            if (cuisineFilter) {
                cuisineFilter.addEventListener('change', filterRestaurants);
            }
            
            if (dietFilter) {
                dietFilter.addEventListener('change', filterRestaurants);
            }
            
            // Reset filters
            const resetFilters = document.getElementById('reset-filters');
            if (resetFilters) {
                resetFilters.addEventListener('click', function() {
                    if (searchInput) searchInput.value = '';
                    if (cuisineFilter) cuisineFilter.value = '';
                    if (dietFilter) dietFilter.value = '';
                    filterRestaurants();
                });
            }
    
            // Profile dropdown toggle
            const profileButton = document.getElementById('profile-button');
            if (profileButton) {
                profileButton.addEventListener('click', function() {
                    const dropdown = document.getElementById('profile-dropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                        profileButton.setAttribute('aria-expanded', dropdown.classList.contains('hidden') ? 'false' : 'true');
                    }
                });
            }
    
            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('profile-dropdown');
                const profileButton = document.getElementById('profile-button');
                
                if (dropdown && profileButton && 
                    !profileButton.contains(event.target) && 
                    !dropdown.contains(event.target)) {
                    dropdown.classList.add('hidden');
                    profileButton.setAttribute('aria-expanded', 'false');
                }
            });
            
            // Load restaurants initially
            loadRestaurants();
        });
    
        // Filter restaurants based on search and filters
        function filterRestaurants() {
            const searchTerm = document.getElementById('restaurant-search')?.value.toLowerCase() || '';
            const cuisineFilter = document.getElementById('cuisine-filter')?.value || '';
            const dietFilter = document.getElementById('diet-filter')?.value || '';
            
            const recommendedCards = document.querySelectorAll('#recommended-restaurants > div');
            const allCards = document.querySelectorAll('#all-restaurants > div');
            
            // Filter recommended restaurants
            recommendedCards.forEach(card => {
                const name = card.querySelector('h3')?.textContent.toLowerCase() || '';
                const description = card.querySelector('p')?.textContent.toLowerCase() || '';
                const cuisineBadges = Array.from(card.querySelectorAll('.flex-wrap span')).map(span => span.textContent.toLowerCase());
                
                const matchesSearch = searchTerm === '' || 
                    name.includes(searchTerm) || 
                    description.includes(searchTerm);
                
                const matchesCuisine = cuisineFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(cuisineFilter));
                
                const matchesDiet = dietFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(dietFilter));
                
                if (matchesSearch && matchesCuisine && matchesDiet) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Filter all restaurants
            allCards.forEach(card => {
                const name = card.querySelector('h3')?.textContent.toLowerCase() || '';
                const description = card.querySelector('p')?.textContent.toLowerCase() || '';
                const cuisineBadges = Array.from(card.querySelectorAll('.flex-wrap span')).map(span => span.textContent.toLowerCase());
                
                const matchesSearch = searchTerm === '' || 
                    name.includes(searchTerm) || 
                    description.includes(searchTerm);
                
                const matchesCuisine = cuisineFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(cuisineFilter));
                
                const matchesDiet = dietFilter === '' || 
                    cuisineBadges.some(badge => badge.includes(dietFilter));
                
                if (matchesSearch && matchesCuisine && matchesDiet) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Clean up when page unloads
        window.addEventListener('beforeunload', function() {
            if (authStateListenerUnsubscribe) {
                authStateListenerUnsubscribe();
            }
        });
    </script>
</body>
</html>